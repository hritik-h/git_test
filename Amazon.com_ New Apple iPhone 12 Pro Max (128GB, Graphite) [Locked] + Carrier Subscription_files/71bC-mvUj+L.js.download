(function(u){var t=window.AmazonUIPageJS||window.P,y=t._namespace||t.attributeErrors,v=y?y("AmazonDevicesDetailPageInstantSavingsAssets",""):t;v.guardFatal?v.guardFatal(u)(v,window):v.execute(function(){u(v,window)})})(function(u,t,y){u.when("A").register("trade-in-constants",function(l){return{unauthorizedCode:401,maxTradeInItemQuantityStatusCode:204,autoCompleteUrl:"https://completion.amazon.com/api/2017/suggestions?",autoCompleteUrlSuffix:"/api/2017/suggestions?",tradeInRouteBase:"/tradein/hzw/",
appraisalInputName:"appraisal",customerIpPreferenceInputName:"instantPaymentPreference",appraisalReturn:"RETURN_WORSE",appraisalAccept:"ACCEPT_WORSE",itemSelectEligibleContext:"eligible",itemSelectSearchContext:"search",maximumTradeInItemsCount:5,tradeInSearchAlias:"ereaders",tradeInSearchPageSize:20,tanookiV2DesktopRowSize:3,tanookiV2MobileRowSize:2,tanookiV2DesktopSearchPageSize:15,tanookiV2MobileSearchPageSize:10,tradeInSearchResultsLoadContext:"onLoad",tradeInSearchResultsScrollContext:"onScroll",
sessionStorageAccessErrorMsg:"Session storage access blocked",AUTH_PORTAL_ASSOC_HANDLE:{com:"amzn_tradein_horizonte_us",uk:"amzn_tradein_horizonte_uk",de:"amzn_tradein_horizonte_de"},tradeInSecondaryViewName:"tradeInSecondaryView",tradeInModalName:"tradeInModal",tradeInSideSheetName:"tradeInSideSheet",csrfKeyMap:"csrfKeyMap",csrfQueryParam:"requestToken",csrfSearchRequestKey:"searchRequestKey",csrfReviewRequestKey:"reviewRequestKey",csrfRemoveRequestKey:"removeItemRequestKey",csrfSubmitRequestKey:"submitRequestKey",
csrfSaveGradedItemKey:"saveGradedItemRequestKey",csrfSearchAsinCategoryItemKey:"searchAsinCategoryRequestKey",validConditions:"N/A;Neutral;New;LikeNew;VeryGood;Good;Working;Acceptable;Damaged;NonFunctional;Unacceptable;Ruined;Wrong Item".split(";"),resetAllElementsEvent:"resetAllElementsEvent",priceBlockSessionStorageKey:"launchTradeInPriceBlock",tanookiSessionStorageKey:"launchTradeIn",priceBlockIngressType:"tradein-price-block",tanookiBuyboxMetric:"tanooki_launch_buy_box",tanookiBuyboxMobileMetric:"tanooki_launch_buy_box_mobile",
tanookiPriceblockMetric:"tanooki_launch_price_block",tanookiPriceblockMobileMetric:"tannoki_launch_price_block_mobile",tanookiV2PastPurchaseSelectedMetric:"tv2_past_purchase_item_selected",refTagPrefix:"dp_trdv2_is_",refTagPrefixMobile:"dp_trdv2_is_m_",refTagPriceBlockPrefix:"dp_price_block_",refTagPriceBlockPrefixMobile:"dp_price_block_m_",refTagListItemsView:"list_items_view",refTagSearchItemsView:"search_items_view",refTagConditionView:"condition_view",refTagConfirmationView:"confirmation_view",
refTagSuccessfulView:"success_view",refTagItemSelect:"item_selected",refTagItemDeSelect:"item_deselected",refTagSearchTermRequest:"search_term_request_",refTagSearchItemSelect:"search_item_select",refTagSearchItemRemoveClick:"search_remove_click",refTagBackClick:"back_click",refTagListItemsContinueClick:"list_items_continue_click",refTagGradedConditionClick:"graded_condition_",refTagAppraisalAccept:"appraisal_accept",refTagAppraisalReturn:"appraisal_return",refTagConditionContinueClick:"condition_continue_click",
refTagReviewInstantPaymentView:"review_ip_view",refTagReviewNonInstantPaymentView:"review_nip_view",refTagReviewMixedBagPaymentView:"review_mb_view",refTagChangeConditionClick:"change_condition_click",refTagDeleteClick:"delete_click",refTagReturnAddressUpdateRequest:"return_address_update_request",refTagReturnAddressUpdateView:"return_address_update_view",refTagTradeInMoreItems:"trade_more_items",refTagReturnToShopping:"return_to_shopping_click",refTagLogInPrompt:"log_in_prompt",refTagWeWantYouToKnow:"we_want_you_to_know_expanded",
refTagPromotionInformationPopoverView:"promotion_information_panel_view",refTagAppraisalLearnMorePopoverView:"appraisal_learn_more_panel_view",refTagRegisteredDevicesLearnMorePopoverView:"registered_devices_learn_more_panel_view",refTagViewDropOffLocations:"view_drop_off_locations",refTagViewUBIFLocations:"view_ubif_locations",refTagButtonExperimentPreFix:"tanooki_",refTagTanookiLaunchedWithBorder:"launched_with_border",refTagTanookiLaunchedWithOutBorder:"launched_without_border",refTagTermsAndConditions:"select_terms_and_conditions",
refTagHowToLink:"select_how_to_link",refTagPrintShippingLabel:"tv2_print_shipping_label",refTagNearbyProcessorsMobile:"nearby_processors_m",refTagNearbyProcessorsDesktop:"nearby_processors",refTagTv2:"tv2_",refTagAuthRequired:"AuthReq",refTagAuthCompleted:"AuthComp",refTagBackButton:"Back_",refTagExit:"Exit_",refTagEnd:"End",refTagChangeCondition:"ChgCond",refTagRemoveCartItem:"RmvItm",refTagHazmatError:"HazmatError",refTagIPDowngrade:"IPDowngrade",refTagIPUpgrade:"IPUpgrade",refTagMFAFailure:"_mfaFailure",
refTagMFASuccess:"_mfaSuccess",BIFURCATION_REF_TAG:["tradein-manufacturer","tradein-vg-type"],VIEW_REF_TAG:{manufacturer:"Man",model:"Mod","model-family":"ModFam","storage-size":"Stor","product-category":"product_category",carrier:"Carr","Console-Generation":"ConGen",platform:"Plat","trade-in-item-type":"IT",".refinement-search-view":"Search","#conditionViewTemplate":"Cond",".submit-trade-in-content":"Review",".tradein-cart-view":"Cart","#tradeinReviewYourOrderNextStepTemplate":"NxtStp"},PRODUCT_GROUP_REF_TAG:{gl_wireless:"Wir",
gl_electronics:"Elec",gl_video_games:"VG",gl_digital_video_games:"VG",gl_digital_products_3:"AUCC"},PRODUCT_GROUP_FLOW_REF_TAG:{gl_wireless:"WL",gl_electronics:"WL",gl_video_games:"VG",gl_digital_video_games:"VG",gl_digital_products_3:"AUCC"},APPRAISAL_REF_TAG:{ACCEPT_WORSE:"Accpt",RETURN_WORSE:"Dcln"},eligibleListViewClass:".tradein-eligible-list-view",searchResultsListViewClass:".tradein-search-results-list-view",selectedItemConditionViewClass:".tradein-selected-item-condition-view",selectedItemsConfirmationViewClass:".tradein-selected-items-confirmation-view",
successfulViewClass:".tradein-successful-view",tradeInWrapperClass:".tradein-wrapper",checkboxItemThumbTemplateId:"#checkboxItemThumbTemplate",eligibleItemTemplateId:"#eligibleItemTemplate",questionRadioButtonTemplateId:"#questionRadioButtonTemplate",questionRadioTemplateId:"#questionRadioTemplate",radioButtonTemplateId:"#radioButtonTemplate",itemConfirmationTemplateId:"#itemConfirmationTemplate",asinDetailsViewTemplateId:"#asinDetailsViewTemplate",eligibleListViewTemplateId:"#eligibleListViewTemplate",
pastPurchasedListViewTemplateId:"#pastPurchasedListViewTemplate",searchResultsListViewTemplateId:"#searchResultsListViewTemplate",searchResultItemTemplateId:"#searchResultItemTemplate",selectedItemConditionViewTemplateId:"#selectedItemConditionViewTemplate",selectedItemsConfirmationViewTemplateId:"#selectedItemsConfirmationViewTemplate",successfulTradeInViewTemplateId:"#successfulTradeInViewTemplate",radioButtonRestrictionSelectionTemplateId:"#radioButtonRefinementSelectorViewTemplate",cardItemRestrictionSelectionViewTemplateId:"#searchRestrictionCardItemSelectionTemplate",
conditionViewTemplateId:"#conditionViewTemplate",tradeinHeaderViewTemplateId:"#tradeinHeaderViewTemplate",tradeinCartHeaderTemplateId:"#tradeInCartHeaderTemplate",tradeinCartSubmitViewHeaderTemplateId:"#tradeInCartHeaderTemplateSubmitView",tradeInCartPromosTemplateId:"#tradeInCartPromosTemplate",tradeInPromoPreviewViewTemplate:"#tradeInPromoPreviewViewTemplate",verticalComplexCardViewTemplateId:"#verticalComplexCardViewTemplate",appraisalSelectionComponentViewId:"#appraisalSelectionComponentView",
promotionInformationComponentId:"#promotionInformationComponent",appraisalWrapperClass:".appraisal-wrapper",conditionAppraisalMaxTivClass:".appraisal-max-tiv",appraisalTivHeaderClass:".appraisal-tiv-header",appraisalTivPriceClass:".appraisal-tiv",termsAndAgreementViewTemplateId:"#termsAndAgreementViewTemplate",multiItemTermsAndAgreementViewTemplateId:"#additionalItemTermsAndAgreementViewTemplate",multiItemTermsAndAgreementViewTemplateDevicesId:"#additionalItemTermsAndAgreementViewTemplateDevices",
tradeinReviewYourOrderNextStepTemplateId:"#tradeinReviewYourOrderNextStepTemplate",mixedOfferNextStepsTemplateId:"#mixedOfferNextStepsTemplate",multiItemConfirmationOrderDetailsViewComponentClass:".multiItemConfirmationOrderDetailsViewComponent",wirelessHowToViewTemplateId:"#wirelessHowToViewTemplate",howToLinkHelperTitleId:"#categoryHelperTitle",tradeinFooterComponentId:"#tradeinFooterComponent",successfulTradeInBannerComponentViewId:"#successfulTradeInBannerComponentView",restrictionSelectionViewTemplateId:"#restrictionSelectionViewTemplate",
tradeInSubmitConditionButtonTemplateId:"#tradeInSubmitConditionButtonTemplate",conditionQuestionnaireListClass:".questionnaires-list",conditionQuestionContainerClass:".condition-question-container",conditionQuestionButtonSelectorClass:".question-selector-button",conditionPageEstimatedTivComponentsSelector:"#tradeinEstimateOfferComponent .estimate-component",conditionPageFinalTivComponentsSelector:"#tradeinEstimateOfferComponent .final-component",conditionPageHeaderTivSelector:"#tradeinEstimateOfferComponent #tradeInValue",
binaryQuestionnaireListViewTemplateId:"#binaryQuestionnaireListViewTemplate",searchRefinementItemSelectionTemplateId:"#searchRefinementItemSelectionTemplate",refinementSearchViewTemplateId:"#refinementSearchViewTemplate",refinementSearchInputSelector:".refinement-search-input",refinementSearchInputMobileSelector:".refinement-search-input input",refinementSearchAllOffersCountId:"#searchAllOffersCount",refinementSearchOnlyOffersCountId:"#searchOnlyOffersCount",refinementSearchResultSelector:".refinement-selection-content .refinement-column",
shipmentDetailViewComponentId:"#shipmentDetailViewComponent",dropOffBannerNoLinkComponentId:"#dropOffBannerNoLinkComponent",dropOffBannerNoLinkTemplateId:"#dropOffBannerNoLinkTemplate",dropOffLocationExpanderId:"#dropOffLocationExpander",dropOffLocationsTemplateId:"#dropOffLocationsTemplate",dropOffLocationListTemplateId:"#dropOffLocationListTemplate",offlineMessageSectionClass:".offline-message-section",tradeInOfferOverviewTemplateId:"#tradeInOfferOverviewTemplate",categoryRefinementSelectionItemComponentId:"#categoryRefinementSelectionItemComponent",
tradeinCartItemComponentId:"#tradeInCartItemComponent",shipmentDetailsHeaderComponentClass:".shipment-details-header-component",tradeinSubmitButtonComponentClass:".tradein-submit-button-container",tradeinSubmitWrapperComponentId:"#tradeinSubmitWrapper",refinementSelectionViewWrapperClass:".refinement-selection-view",refinementContentWrapperClass:".refinement-content-wrapper",refinementSearchViewClass:".refinement-search-view",submitTradeInWrapperClass:".submit-trade-in-content",searchRestrictionWrapperClass:".search-restriction-wrapper",
searchLoadMoreResultsWrapperClass:".load-more-results-wrapper",cardItemRestrictionSelectionViewClass:".restriction-selection-view",wirelessTradeInReviewYourOrderViewClass:".wireless-tradein-review-your-order-view",tradeInCartViewClass:".tradein-cart-view",tradeInCartTemplateId:"#tradeInCartViewTemplate",tradeinCartTotalTivElement:".cart-total-tiv",tradeinCartGCValueIpElement:"#gcValueIp",tradeinCartGCValueNonIpElement:"#gcValueNonIp",tradeinCartIpItemsSection:".tradein-cart-view-ip-items",tradeinCartNonIpItemsSection:".tradein-cart-view-nip-items",
tradeinCartIpItemsList:".tradein-cart-item-list-ip",tradeinCartNonIpItemsList:".tradein-cart-item-list-nip",continueConditionButtonViewClass:".continue-trigger",submitButtonViewClass:".handle-submit-your-tradein",reviewButtonViewClass:".handle-review-your-tradein",tradeInMoreItemsButtonViewClass:".handle-trade-in-more-items",agreementCheckboxTarget:".agreement-checkbox-target",tradeInMoreItemsButtonContainerClass:".tradein-more-items-button-container",searchInputClass:".search-input",searchInputClassMobile:".search-input input",
searchFormClass:".search-form",searchSuggestionsClass:".tradein-autocomplete-dropdown-menu",eligibleItemsCountId:"#eligibleItemsCount",dateRegisteredClass:".registered-date",eligibleItemListClass:".tradein-eligible-item-list",eligibleItemListWrapper:".tradein-eligible-item-list-wrapper",searchResultListClass:".tradein-search-result-list",reviewTradeInItemsSubmitId:"#reviewTradeInItemsSubmit",customerPastDevicesPurchasesCarouselContainerId:"#customerPastDevicesPurchasesCarouselContainer",currentSelectedItemIndexId:"#currentSelectedItemIndex",
selectedItemTotalCountId:"#selectedItemTotalCount",backButtonClass:".back-button",continueButtonClass:".continue-button",alertMaxItemQuantityClass:".tradein-error-quantity-limit",alertMaxItemsWarningClass:".tradein-warning-max-items",alertMaxItemsWarningClassMobile:".tradein-mobile-warning-max-items",alertMaxGCValueWarningClass:".tradein-warning-max-gc-value",alertMaxGCValueWarningClassMobile:".tradein-mobile-warning-max-gc-value",alertPromptLoginClass:".tradein-prompt-log-in",alertItemAcceptableClass:".tradein-info-unacceptable-error",
alertItemAcceptableClassMobile:".tradein-mobile-info-unacceptable-error",alertMaxItemQuantityBannerClass:".tradein-max-quantity-error",loadingSpinnerClass:".tradein-loading-spinner",loadingSideSheetSpinnerClass:".asin-selection-tradein-loading-spinner",searchLoadingSpinnerClass:".tradein-search-loading-spinner",tradeinCartHeaderItemsSingularClass:".tradein-cart-header-items-singular",tradeinCartHeaderItemsPluralClass:".tradein-cart-header-items-plural",tradeInQuantityExceededErrorSelector:".tradein-templates .tradein-info-quantity-exceeded-error",
tradeInErrorExitButtonSelector:".tradein-templates .tradein-error-exit-button",tradeInMixHazmatErrorSelector:".tradein-templates .tradein-info-mix-hazmat-error",tradeInMixHazmatCartItemErrorSelector:".tradein-templates .tradein-info-mix-hazmat-error-cart-item",tradeInHazmatItemList:".hazmat-item-list",tradeInHazmatListItemTemplate:".hazmat-asin-list-item-template",tradeInNonTradeableErrorSelector:".tradein-templates .tradein-info-non-tradeable-error",complexCardRefinementSelectionViewType:"COMPLEX_CARD_VIEW",
simpleCardRefinementSelectionViewType:"SIMPLE_CARD_VIEW",containedButtonRefinementSelectionViewType:"CONTAINED_BUTTON_VIEW",searchRefinementViewType:"SEARCH_CARD_VIEW",tradeInItemTypeEcho:"US_Echo",tradeInEchoGl:"gl_digital_products_3",tradeInWirelessGl:"gl_wireless",tradeInVGGl:"gl_video_games",tradeInDigitalVGGL:"gl_digital_video_games",tradeInElectronicsGL:"gl_electronics",tradeInVGProductGroups:["gl_video_games","gl_digital_video_games"],wirelessVgProductGroups:["gl_wireless","gl_video_games",
"gl_digital_video_games","gl_electronics"],tradeInCCCardEligibleGls:["gl_wireless"],tradeInLaunchButtonDeclarativeActionSelector:"#tradeInLaunchAction",instantPaymentPreferenceInputName:"instantPaymentPreference",instantPaymentNow:"PAID_NOW",instantPaymentLater:"PAID_LATER"}});"use strict";u.when("A","trade-in-constants","tanooki-ingress-button-treatment").register("trade-in-common-utils",function(l,m,k){var a=l.$,h={locale:null,currencyCode:null,productGroup:null,deviceType:null,asin:null,modalTitle:null,
refTagPrefix:null,refTagPrefixMobile:null,captureTradeInContext:function(){var e=a("#tanookiWidgetState").data("tanookiWidgetState");e?(e.hasOwnProperty("productGroup")?this.productGroup=e.productGroup:this.recordMetric("productGroupMissing"),e.hasOwnProperty("deviceType")?this.deviceType=e.deviceType:this.recordMetric("deviceTypeMissing"),e.hasOwnProperty("tanookiTitle")?this.modalTitle=e.tanookiTitle:this.recordMetric("deviceModalHeaderMissing"),e.hasOwnProperty("asin")&&(this.asin=e.asin)):this.recordMetric("widgetContextMissing")},
updateTradeInContext:function(e){var g=a("#tanookiWidgetState").data("tanookiWidgetState");g.hasOwnProperty("productGroup")&&e.hasOwnProperty("productGroup")&&(g.productGroup=e.productGroup);g.hasOwnProperty("deviceType")&&e.hasOwnProperty("deviceType")&&(g.deviceType=e.deviceType);g.hasOwnProperty("tanookiTitle")&&e.hasOwnProperty("tanookiTitle")&&(g.tanookiTitle=e.tanookiTitle);g.hasOwnProperty("asin")&&e.hasOwnProperty("asin")&&(g.asin=e.asin);document.getElementById("tanookiWidgetState").dataset.tanookiWidgetState=
JSON.stringify(g);this.captureTradeInContext()},getProductGroup:function(){return this.productGroup},setRefTagPrefix:function(a){this.refTagPrefix=a},getRefTagPrefix:function(){return this.refTagPrefix?this.refTagPrefix:m.refTagPrefix},setRefTagPrefixMobile:function(a){this.refTagPrefixMobile=a},getRefTagPrefixMobile:function(){return this.refTagPrefixMobile?this.refTagPrefixMobile:m.refTagPrefixMobile},getCurrentAsin:function(){return this.asin},getDeviceType:function(){return this.deviceType},getModalTitle:function(){return this.modalTitle||
""},setLocale:function(a){this.locale=a},setCurrencyCode:function(a){this.currencyCode=a},formatCurrency:function(a){this.currencyCode||this.recordError("Missing currency code","trade-in-common-utils");a=parseFloat(a);return a.toLocaleString(this.locale.replace("_","-"),{style:"currency",currency:this.currencyCode})},formatDate:function(a){if(!a)return"";a=a.split(" ");return a[0]+" "+a[1]+" "+a[2]},redirectToAuth:function(a,g){var c=t.location,b="https://"+c.host,d=c.search.replace(/\&$/,""),c=c.pathname+
d+c.hash,d=b;-1<b.indexOf("aka.corp.amazon.com")&&(d="https://development.amazon.com");a=d+"/ap/signin?_encoding\x3dUTF8\x26openid.assoc_handle\x3d"+a+"\x26openid.claimed_id\x3dhttp://specs.openid.net/auth/2.0/identifier_select\x26openid.identity\x3dhttp://specs.openid.net/auth/2.0/identifier_select\x26openid.mode\x3dcheckid_setup\x26openid.ns\x3dhttp://specs.openid.net/auth/2.0\x26openid.return_to\x3d"+b+c;try{t.sessionStorage&&sessionStorage.setItem(g,!0)}catch(p){this.recordError(p,"Session storage access blocked")}t.location.href=
encodeURI(a)},redirectToMFA:function(a){var g="https://"+t.location.host;-1<g.indexOf("aka.corp.amazon.com")&&(g="https://development.amazon.com");t.location.href=encodeURI(g+a)},getAuthPortalHandleFromHostname:function(){var a=t.location.hostname.match(/^(?:(?:(?:(\w\w)-)?pre-prod)|(?:(?:(\w\w)-)?development)|(?:.+))\.amazon.(?:(\w\w)|(com)|(?:co\.(?:(\w\w))))?$/);if(a)for(var g=1;g<a.length;g++)if(a[g])return m.AUTH_PORTAL_ASSOC_HANDLE[a[g]];return m.AUTH_PORTAL_ASSOC_HANDLE.com},recordError:function(a,
g){t.ueLogError&&t.ueLogError({message:a,logLevel:"ERROR",attribution:"tradein: "+g})},recordMetric:function(a){t.ue&&t.ue.count&&(a="tradeIn_"+a,t.ue.count(a,(t.ue.count(a)||0)+1))},findMinMaxTivInContainer:function(a){var g,c;Object.keys(a).forEach(function(b,d){b=a[b];0===d?c=g=b.tiv:(d=b.tiv,g=d<g?d:g,c=d>c?d:c)});return[g,c]},getMashModalUrl:function(a){var g="https://"+t.location.host,c="\x26cb\x3d"+Math.round((new Date).getTime()/1E3);return g+a+c},getCsrfTokenByKey:function(a,g){return g.hasOwnProperty(m.csrfKeyMap)&&
g[m.csrfKeyMap][a]?g[m.csrfKeyMap][a]:""},updateCsrfTokenByKey:function(a,g,c){g.hasOwnProperty(a)&&c.hasOwnProperty(m.csrfKeyMap)&&(c[m.csrfKeyMap][a]=g[a])},recordRefTag:function(a,g,c,b){a=g+c+a;b=a+"_"+this.deviceType+"_"+b;this.doRecordRefTag(a);this.doRecordRefTag(b)},recordTv2RefTag:function(a,g,c){var b="";Array.isArray(c)&&0<c.length&&(b=c.join("_")+"_");a=g+this.getTv2RefTagPrefix()+"_"+b+a+"_"+this.getTv2RefTagPostfix();this.doRecordRefTag(a)},doRecordRefTag:function(e){l.get(e,{error:a.proxy(function(a,
e,b){this.recordError(e+"::"+b,"Error encountered during refTag record request")},this)})},getIngressButtonRefTag:function(){return k.isEnabled?m.refTagTanookiLaunchedWithOutBorder:m.refTagTanookiLaunchedWithBorder},isMobileVariant:function(a){return 0<=["mobile","mobileApp","mobileWeb"].indexOf(a)},getTanookiV2RowSize:function(a){return this.isMobileVariant(a)?m.tanookiV2MobileRowSize:m.tanookiV2DesktopRowSize},getTanookiV2SearchPageSize:function(a){return this.isMobileVariant(a)?m.tanookiV2MobileSearchPageSize:
m.tanookiV2DesktopSearchPageSize},isWirelessVgProductGroup:function(a){return-1!==m.wirelessVgProductGroups.indexOf(a)},isVGProductGroup:function(a){return-1!==m.tradeInVGProductGroups.indexOf(a)},shouldLaunchTanookiV2OnPageLoad:function(){try{if(t.sessionStorage){var a=sessionStorage.getItem("launchAsinCategoryTradeIn"),g={productGroup:sessionStorage.getItem("storefront-product-group"),deviceType:sessionStorage.getItem("storefront-device-type"),modalTitle:sessionStorage.getItem("storefront-modal-title")};
g.productGroup&&this.updateTradeInContext(g);return a?(sessionStorage.removeItem("launchAsinCategoryTradeIn"),sessionStorage.removeItem("storefront-product-group"),sessionStorage.removeItem("storefront-device-type"),sessionStorage.removeItem("storefront-modal-title"),sessionStorage.removeItem("is-storefront"),!0):!1}}catch(c){h.recordError(c,"Session storage access blocked")}},getStorefrontSessionStorage:function(){try{if(t.sessionStorage&&sessionStorage.getItem("is-storefront"))return!0}catch(a){h.recordError(a,
"Session storage access blocked")}},setStorefrontSessionStorage:function(a){try{t.sessionStorage&&(a&&sessionStorage.setItem("is-storefront",!0),sessionStorage.setItem("storefront-product-group",h.getProductGroup()),sessionStorage.setItem("storefront-device-type",h.getDeviceType()),sessionStorage.setItem("storefront-modal-title",h.getModalTitle()))}catch(g){h.recordError(g,"Session storage access blocked")}},getSortedConditionTradeInValues:function(e){var g=[],c=e.conditionOfferMap,b=m.validConditions,
d;for(d in c)if(c.hasOwnProperty(d))if(-1===a.inArray(d,b))h.recordError("Invalid condition",d+" was not found in validConditions array for type: "+e.tradeInItemType);else{var p=c[d];p.hasOwnProperty("tiv")&&g.push(p.tiv)}g.sort(function(a,b){return a-b});return g},getProductGroupRefTag:function(a){return m.PRODUCT_GROUP_FLOW_REF_TAG[a]},getTv2RefTagPrefix:function(){return m.refTagTv2+m.PRODUCT_GROUP_FLOW_REF_TAG[this.productGroup]},getTv2RefTagPostfix:function(){return("web"===this.deviceType?"D_":
"M_")+m.PRODUCT_GROUP_REF_TAG[this.productGroup]},generatePrettyTitle:function(a){return a.split("(Trade")[0]},isGlEligibleForPastPurchases:function(a){return a===m.tradeInEchoGl},isGlEligibleForPromotions:function(a){return a===m.tradeInEchoGl},isCETechGl:function(a){return a===m.tradeInWirelessGl||a===m.tradeInDigitalVGGL||a===m.tradeInVGGl||a===m.tradeInElectronicsGL},isTradeInLaunchedFromWisper:function(a){return["launch-tanooki-wireless","redirect-to-login-wireless"].includes(a)},isGlEligibleForCCCard:function(a){return m.tradeInCCCardEligibleGls.includes(a)},
createNearbyProcessorsList:function(e,g,c){g.empty();a.each(e,a.proxy(function(b,d){b=a("\x3cdiv/\x3e");var p=a("\x3cdiv/\x3e"),e=a("\x3cdiv/\x3e"),n=a("\x3cdiv/\x3e"),f=d.processorAddress.line1+" "+d.processorAddress.line2,r=d.processorAddress.city+" "+d.processorAddress.state+" "+d.processorAddress.postalCode+" "+d.processorAddress.countryCode;b.html(d.processorAddress.fullName).addClass("a-text-bold a-spacing-top-medium");p.html(f);e.html(r);g.append(b).append(p).append(e).append(n);c.append(g)},
this))}};l.on("a:pageUpdate",function(){l.state.parse();h.captureTradeInContext()});return h});"use strict";u.when("A").register("trade-in-data-binder",function(l){function m(a,g,c,b,d){var p=a.find(".refinement-content-wrapper"),q=0;0<b.length&&(q=d.getTanookiV2RowSize(c));if(p&&0<q){c=Math.ceil(g.length/q);var n="a-span"+Math.floor(12/q);d=h(p).find(".dynamic-row");for(var n=d.find(".refinement-column").removeClass("a-span12").addClass(n),f=0;f<q-1;f++){var r=h(n).clone();d.append(r)}for(q=0;q<
c-1;q++)n=d.clone(),p.append(h(n));a.find(".refinement-column").each(function(a,r){r=h(r);r.data("dynamicColumn")&&(r.find(".refinement-selection-component-view").each(function(a,r){a=h(r);a.data("viewType")!==b&&a.remove()}),a>=g.length&&r.addClass("aok-hidden"))})}}function k(a,g){var c=!1;a.hasOwnProperty("showBooleanField")&&(a=a.showBooleanField,"!"===a.charAt(0)?(a=a.substr(1),c=!1===g.hasOwnProperty(a)?!0:!1!==g[a]):c=!1===g.hasOwnProperty(a)?!0:!0!==g[a]);return c}function a(a,g){var c=a.lastIndexOf(".");
-1!==c&&(a=[a.slice(0,c+1),"_SL"+g+"_SR"+g+","+g+"_.",a.slice(c+1)].join(""));return a}var h=l.$;return{bindDataToTemplate:function(e){if(!(0<e.length&&""===h.trim(e.html()))){var g=h(e.clone().html());g.find("*").each(function(a,b){a=h(b);if(b=a.data("transcludeTemplate"))b=h(".tradein-templates #"+b),0<b.length&&a.html(b.clone().html())});try{if(1<arguments.length)for(var c=g.find("*"),b=1;b<arguments.length;b++){var d=arguments[b];c.each(h.proxy(function(b,c){b=h(c);c=b.data();if(c.hasOwnProperty("hideEmptyField")?
!d.hasOwnProperty(c.hideEmptyField)||!d[c.hideEmptyField]:k(c,d))return b.remove(),!0;b.show();for(var e in d)if(d.hasOwnProperty(e)&&(c=b.data(e))&&"string"===typeof c)switch(c){case "id":c=d[e];"date"===b.data("decorator")&&(c=this.tradeInCommonUtils.formatDate(c));b.find("#"+e).html(c);break;case "text":c=d[e];"price"===b.data("decorator")&&(c=this.tradeInCommonUtils.formatCurrency(c.toFixed(2)));b.html(c);break;case "textAppend":c=d[e];b.append(c);break;case "data":b.attr("data-"+e,d[e]);break;
case "bind":break;default:var f=d[e];"squareImage"===b.data("decorator")&&(f=a(f,300));b.attr(c,f)}},this))}}catch(p){this.tradeInCommonUtils.recordError(p,"Error encountered during data bind to template")}return g}},setCommonUtils:function(a){this.tradeInCommonUtils=a},bindCategoryRefinementDataToTemplate:function(e,g,c,b){b=b||{};var d=g.selectionItemsAttributeList,p=g.refinementTitle,q=g.refinementKey;g=g.viewType;if(!(0<e.length&&""===h.trim(e.html()))){e=h(e.clone().html());m(e,d,c,g,this.tradeInCommonUtils);
var n=0;try{var f=e.find("*"),r=b;f.each(h.proxy(function(b,f){b=h(f);f=b.data();if(k(f,r))return b.remove(),!0;b.show();f.hasOwnProperty("refinementTitle")&&b.html(p);f.hasOwnProperty("endColumn")&&n++;f.hasOwnProperty("maxTiv")&&n<d.length&&b.html(this.tradeInCommonUtils.formatCurrency(d[n].maxTiv));f.hasOwnProperty("displayTitle")&&n<d.length&&b.html(d[n].displayTitle);if(f.hasOwnProperty("imageUrl")&&n<d.length){var c=d[n].imageUrl;f.hasOwnProperty("decorator")&&"squareImage"===f.decorator&&(c=
a(c,150));b.attr(b.data("imageUrl"),c)}f.hasOwnProperty("asinDetailsData")&&n<d.length&&(c={maxTiv:d[n].maxTiv,refinementKey:q,refinementValue:d[n].emittedData},d[n].asinDisplayProperties&&(c.platform=d[n].asinDisplayProperties.hardwarePlatform,c.ean=d[n].asinDisplayProperties.eanNumber,c.upc=d[n].asinDisplayProperties.upc),d[n].imageUrl&&(c.imageUrl=d[n].imageUrl),d[n].displayTitle&&(c.displayTitle=d[n].displayTitle),d[n].hasOwnProperty("isEnabled")&&(c.isEnabled=d[n].isEnabled),b.data("asinDetailsData",
c));f.hasOwnProperty("tradeinSupplementaryData")&&n<d.length&&(c={maxTiv:d[n].maxTiv},d[n].imageUrl&&(c.imageUrl=d[n].imageUrl),c.maxTiv&&b.data("tradeinSupplementaryData",c));f.hasOwnProperty("refinementKey")&&n<d.length&&b.data("refinementKey",q);f.hasOwnProperty("refinementValue")&&n<d.length&&b.data("refinementValue",d[n].emittedData);f.hasOwnProperty("disabledAttribute")&&n<d.length&&(d[n].hasOwnProperty("isEnabled")&&!d[n].isEnabled&&(f=b.closest(".submit-refinement"),f.addClass("a-button-toggle"),
f.addClass("a-button-unavailable"),b.addClass("a-button-disabled"),h(b).attr("disabled",!0),b.closest(".card-content-box").addClass("unavailable-item")),b.attr(b.data("disabledAttribute"),d[n].isEnabled))},this))}catch(w){throw this.tradeInCommonUtils.recordError(w,"Error binding data to REFINEMENT SELECTION template"),"[Error at bindCategoryRefinementDataToTemplate]"+w;}return e}},bindDataToAsinSelectionTemplate:function(a){if(!(0<a.length&&""===h.trim(a.html()))){var g=h(a.clone().html());try{if(1<
arguments.length)for(var c=g.find("*"),b=1;b<arguments.length;b++){var d=arguments[b];c.each(h.proxy(function(a,b){a=h(b);b=a.data();var c=!1;if(b.hasOwnProperty("instantPaymentEligible")){var f=b.instantPaymentEligible;d.hasOwnProperty("instantPaymentEligible")&&f!==d.instantPaymentEligible&&(c=!0)}else c=k(b,d);if(c)return a.remove(),!0;a.show();b.hasOwnProperty("progressPercentage")&&d.hasOwnProperty("progressPercentage")&&a.css("width",d.progressPercentage);b.hasOwnProperty("tradeinSupplementaryData")&&
a.data("tradeinSupplementaryData",{maxTiv:d.maxTiv,imageUrl:d.imageUrl});b.hasOwnProperty("refinementKey")&&a.data("refinementKey",d.restrictionKey);b.hasOwnProperty("refinementValue")&&a.data("refinementValue",d.restrictionValue);for(var r in d)if(d.hasOwnProperty(r)&&(b=a.data(r))&&"string"===typeof b)switch(b){case "displayTitle":a.html(d[r]);break;case "subtitle":a.html(d[r]);break;case "src":a.attr(b,d[r]);break;case "classType":a.removeClass("aok-hidden");break;case "tiv":a.html(this.tradeInCommonUtils.formatCurrency(d[r]));
break;case "data":a.attr("data-"+r,d[r])}},this))}}catch(p){throw this.tradeInCommonUtils.recordError(p,"Error encountered during binding data to the refinementTemplate"),"[Error at bindDataToAsinSelectionTemplate]"+p;}return g}},normalizeGridRowHeights:function(a){h(a).find(".dynamic-row").each(function(a,c){a=h(c).find(".refinement-search-item-title");var b=0;a.each(function(a,c){a=h(c);a.outerHeight()>b&&(b=a.outerHeight())});a.each(function(a,c){h(c).css("height",b)})})}}});"use strict";u.when("A",
"a-popover","a-button","trade-in-constants","trade-in-common-utils","trade-in-data-binder","ip-preference-buttons","ready").register("trade-in-base-controller",function(l,m,k,a,h,e,g){var c=l.$;return l.createClass({config:null,deviceType:null,authPortalAssocHandle:null,selectedEligibleItems:null,navViews:null,navCurrentView:null,navHistory:null,boundedViews:[],searchIsInProgress:!1,searchResultsCache:[],selectedSearchResultItems:null,tradeInReviewData:null,tradeInSubmitData:null,instantPaymentEligible:!1,
customerIpPreference:null,instantPaymentMixed:!1,promotionEligible:!1,hasInitiallyLoaded:!1,hasMaxItemsSelected:!1,hasPendingRequest:!1,promosApplied:[],tradeInViewInstanceName:null,tradeInSaveGradedItemConditionUrl:null,tradeInReviewUrl:null,tradeInRemoveItemUrl:null,tradeInSearchUrl:null,tradeInSubmitUrl:null,tradeInRefTagUrl:null,tradeInRefTagPrefix:null,tradeInProductGroup:null,tradeInSearchCurrentCacheEntry:null,tradeInWrapper:null,loadingSpinner:null,searchInput:null,checkboxItemThumbTemplate:null,
eligibleItemTemplate:null,questionRadioButtonTemplate:null,questionRadioTemplate:null,radioButtonTemplate:null,itemConfirmationTemplate:null,searchResultsListViewTemplate:null,searchResultItemTemplate:null,dropOffBannerNoLinkTemplate:null,dropOffLocationExpander:null,eligibleListViewTemplate:null,selectedItemConditionViewTemplate:null,selectedItemsConfirmationViewTemplate:null,successfulTradeInViewTemplate:null,load:function(){this.config=l.state("tradeInConfig");h.setLocale(this.config.locale);h.setCurrencyCode(this.config.currencyCode);
e.setCommonUtils(h);this.navViews={eligibleListView:a.eligibleListViewClass,selectedItemConditionView:a.selectedItemConditionViewClass,selectedItemsConfirmationView:a.selectedItemsConfirmationViewClass,successfulView:a.successfulViewClass};this.getElements();this.bindEvents();this.cleanState();this.restoreFromState();this.navCurrentView=this.navViews.eligibleListView;this.createView()},setConstants:function(b,d,c){this.tradeInViewInstanceName=b;this.tradeInRefTagPrefix=c;this.tradeInProductGroup=
d;this.tradeInSaveGradedItemConditionUrl=a.tradeInRouteBase+"addToTradeIn";this.tradeInReviewUrl=a.tradeInRouteBase+"reviewTradeInOrder?deviceType\x3d"+this.deviceType+"\x26productGroup\x3d"+d+"\x26ref_\x3d"+c+"review_request_"+d;this.tradeInRemoveItemUrl=a.tradeInRouteBase+"removeItem?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+c+"remove_item_request_"+d;this.tradeInSearchUrl=a.tradeInRouteBase+"searchItems?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+c+"search_request_"+d;this.tradeInSubmitUrl=
a.tradeInRouteBase+"confirmTradeInOrder?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+c+"submit_request_"+d;this.tradeInRefTagUrl=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"},getElements:function(){this.tradeInWrapper=this.base.find(a.tradeInWrapperClass);this.checkboxItemThumbTemplate=this.base.find(a.checkboxItemThumbTemplateId);this.eligibleItemTemplate=this.base.find(a.eligibleItemTemplateId);this.questionRadioButtonTemplate=this.base.find(a.questionRadioButtonTemplateId);
this.questionRadioTemplate=this.base.find(a.questionRadioTemplateId);this.radioButtonTemplate=this.base.find(a.radioButtonTemplateId);this.itemConfirmationTemplate=this.base.find(a.itemConfirmationTemplateId);this.searchResultItemTemplate=this.base.find(a.searchResultItemTemplateId);this.dropOffBannerNoLinkTemplate=this.base.find(a.dropOffBannerNoLinkTemplateId);this.dropOffLocationExpander=this.base.find(a.dropOffLocationExpanderId);this.eligibleListViewTemplate=this.base.find(a.eligibleListViewTemplateId);
this.searchResultsListViewTemplate=this.base.find(a.searchResultsListViewTemplateId);this.selectedItemConditionViewTemplate=this.base.find(a.selectedItemConditionViewTemplateId);this.selectedItemsConfirmationViewTemplate=this.base.find(a.selectedItemsConfirmationViewTemplateId);this.successfulTradeInViewTemplate=this.base.find(a.successfulTradeInViewTemplateId);this.searchInput=this.base.find(this.searchInputClass);this.loadingSpinner=this.base.find(a.loadingSpinnerClass)},bindEvents:function(){this.tradeInWrapper.delegate("a.tradein-login",
"click",c.proxy(function(){var a=h.getAuthPortalHandleFromHostname();h.redirectToAuth(a,"launchTradeIn")},this));this.tradeInWrapper.delegate(a.eligibleListViewClass+' .selectable-wrapper input[type\x3d"checkbox"]',"change",c.proxy(function(b){this.handleSelectableItemClick(b,a.itemSelectEligibleContext)},this));this.tradeInWrapper.delegate(a.eligibleListViewClass+" .selectable-wrapper .selectable-item.disabled.maxasin","click",c.proxy(function(b){b=c(b.currentTarget);0===b.find(a.alertMaxItemQuantityClass).length&&
b.find(".tradein-item-info").prepend(c("#alertTemplates "+a.alertMaxItemQuantityClass).clone())},this));this.tradeInWrapper.delegate(".selectable-item.disabled","click",c.proxy(function(a){this.hasMaxItemsSelected&&this.showAlert(this.alertMaxItemsWarningClass,c(a.currentTarget))},this));this.tradeInWrapper.delegate(a.reviewTradeInItemsSubmitId,"click",c.proxy(function(){this.recordRefTag(a.refTagListItemsContinueClick);this.navCurrentView=this.navViews.selectedItemConditionView;this.goToView()},
this));this.tradeInWrapper.delegate(a.selectedItemConditionViewClass+" "+a.continueButtonClass,"click",c.proxy(this.handleContinueButtonClick,this));this.tradeInWrapper.delegate(a.selectedItemConditionViewClass+" "+a.backButtonClass,"click",c.proxy(this.handleBackButtonClick,this));this.tradeInWrapper.delegate(".button-question","click",c.proxy(this.handleQuestionButtonClick,this));this.tradeInWrapper.delegate('input[name\x3d"'+a.appraisalInputName+'"]',"click",c.proxy(this.handleAppraisalRadioChange,
this));this.tradeInWrapper.delegate('input[name\x3d"'+a.customerIpPreferenceInputName+'"]',"click",c.proxy(this.handleIpPreferenceRadioChange,this));this.tradeInWrapper.delegate(".delete-link","click",c.proxy(this.handleConfirmDeleteClick,this));this.tradeInWrapper.delegate(".change-link","click",c.proxy(this.handleConfirmChangeClick,this));this.tradeInWrapper.delegate("#tradeInMoreItems","click",c.proxy(function(){this.recordRefTag(a.refTagTradeInMoreItems);this.resetEligibleListView();this.navCurrentView=
this.navViews.eligibleListView;this.createView()},this));this.tradeInWrapper.delegate("#confirmTradeInSubmit","click",c.proxy(this.doTradeInSubmit,this));this.tradeInWrapper.delegate(".search-input","focusin",c.proxy(function(){this.tradeInWrapper.find(".search-button").addClass("active")},this));this.tradeInWrapper.delegate(".search-input","focusout",c.proxy(function(){this.tradeInWrapper.find(".search-button").removeClass("active")},this));this.tradeInWrapper.delegate(a.searchFormClass,"submit",
c.proxy(this.handleSearchFormSubmit,this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.searchResultListClass+' input[type\x3d"checkbox"]',"change",c.proxy(function(b){this.handleSelectableItemClick(b,a.itemSelectSearchContext)},this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.continueButtonClass,"click",c.proxy(this.handleSearchContinueButtonClick,this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.backButtonClass,"click",c.proxy(this.handleSearchContinueButtonClick,
this));this.tradeInWrapper.delegate(a.eligibleListViewClass+" .search-remove","click",c.proxy(this.handleSearchItemRemoveClick,this));l.on("a:popover:beforeHide:"+this.tradeInViewInstanceName,c.proxy(function(){for(var a=0;a<this.selectedEligibleItems.length;a++){var d=this.selectedEligibleItems[a];d.hasBeenGraded&&this.isItemInListByAsin(d,this.selectedSearchResultItems)&&(this.spliceItemFromList(d,this.selectedSearchResultItems),this.saveState())}},this))},bindAutoComplete:function(){c(".tradein-autocomplete-dropdown-menu").remove();
var b=this,d=a.autoCompleteUrl;b.config.hasOwnProperty("autoCompleteUrlDomain")&&b.config.autoCompleteUrlDomain&&(d=b.config.autoCompleteUrlDomain+a.autoCompleteUrlSuffix);new v({selector:a.tradeInWrapperClass+" "+this.navCurrentView+" "+this.searchInputClass,minChars:1,cache:!1,menuClass:"tradein-autocomplete-dropdown-menu",source:function(a,e){a&&a.trim().length&&c.ajax({type:"GET",url:d,data:{prefix:a,alias:"amazon-devices",mid:b.config.marketplace,"client-id":"tradein-search-suggestion"},dataType:"json",
success:function(a){var d=[];a&&a.hasOwnProperty("suggestions")&&c.each(a.suggestions,function(a,b){d.push(b.value)});b.searchIsInProgress||e(d)},error:function(){h.recordError("Autocomplete error","Error encountered during autocomplete request")}})},onSelect:function(d,c){b.tradeInSearchCurrentCacheEntry=b.getSearchResultsCacheEntry(c);0===b.tradeInSearchCurrentCacheEntry.eligibleItems.length?b.doTradeInSearch(a.tradeInSearchResultsLoadContext):(b.navCurrentView=a.searchResultsListViewClass,b.createView())}})},
doTradeInSearch:function(b){if(!this.searchIsInProgress){this.searchIsInProgress=!0;c(a.searchSuggestionsClass).hide();this.recordRefTag(a.refTagSearchTermRequest+this.tradeInSearchCurrentCacheEntry.term);if(b===a.tradeInSearchResultsScrollContext){var d=this.tradeInWrapper.find(a.searchResultsListViewClass+" "+a.searchLoadingSpinnerClass);d.addClass("active")}else this.loadingSpinnerShow();var e={"search-alias":a.tradeInSearchAlias,keyword:this.tradeInSearchCurrentCacheEntry.term,pageIndex:this.tradeInSearchCurrentCacheEntry.currentPageIndex,
pageSize:a.tradeInSearchPageSize,pageRefinements:!0,requestToken:this.getCsrfTokenByKey(a.csrfSearchRequestKey)};if(this.config.hasOwnProperty("searchConfigurations")){var q=this.config.searchConfigurations;q.hasOwnProperty("searchAlias")&&(e["search-alias"]=q.searchAlias);q.hasOwnProperty("searchNode")&&(e.node=q.searchNode)}l.post(this.tradeInSearchUrl,{params:e,success:c.proxy(function(e){this.updateCsrfTokenByKey(a.csrfSearchRequestKey,e);this.searchIsInProgress=!1;this.tradeInSearchCurrentCacheEntry.currentPageSize+=
e.pageSize;this.tradeInSearchCurrentCacheEntry.totalAvailableResults=e.totalAvailableResults;e.hasOwnProperty("questionnaires")&&(this.config.questionnaires=c.extend(this.config.questionnaires,e.questionnaires));var f=null;e.hasOwnProperty("eligibleItems")&&(f=Object.keys(e.eligibleItems).map(function(a){return e.eligibleItems[a]}));f&&(this.tradeInSearchCurrentCacheEntry.eligibleItems=c.merge(this.tradeInSearchCurrentCacheEntry.eligibleItems,f));b===a.tradeInSearchResultsScrollContext?(this.tradeInSearchCurrentCacheEntry.currentPageIndex!==
e.pageIndex&&(this.tradeInSearchCurrentCacheEntry.currentPageIndex=e.pageIndex),d.removeClass("active"),f&&(this.createTemplatesByIterable(f,this.searchResultItemTemplate,this.tradeInWrapper.find(".tradein-search-result-list")),this.validateMaxSelectedItems())):(this.loadingSpinnerHide(),this.navCurrentView=a.searchResultsListViewClass,this.createView())},this),error:c.proxy(function(a){this.searchIsInProgress=!1;this.handleRequestError(a,"TradeIn search error","Error encountered during TradeIn search request")},
this)})}},doTradeInReviewValidation:function(b){this.hasPendingRequest||(this.loadingSpinnerShow(),this.hasPendingRequest=!0,l.post(this.tradeInReviewUrl,{params:{currentAsin:h.getCurrentAsin(),requestToken:this.getCsrfTokenByKey(a.csrfReviewRequestKey)},success:c.proxy(function(d){this.updateCsrfTokenByKey(a.csrfReviewRequestKey,d);this.tradeInReviewData=d;this.loadingSpinnerHide();this.hasPendingRequest=!1;b()},this),error:c.proxy(function(b){this.hasPendingRequest=!1;b.hasOwnProperty("http")&&
b.http.status===a.maxTradeInItemQuantityStatusCode?this.handleMaxQuantityError():this.handleRequestError(b,"TradeIn review error","Error encountered during TradeIn review request")},this)}))},doTradeInItemRemove:function(b){this.loadingSpinnerShow();l.post(this.tradeInRemoveItemUrl,{params:{asin:b.asin,decline:!0,requestToken:this.getCsrfTokenByKey(a.csrfRemoveRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfRemoveRequestKey,b);this.loadingSpinnerHide()},this),error:c.proxy(function(a){this.handleRequestError(a,
"TradeIn deselect remove error","Error encountered during TradeIn deselect remove request")},this)})},doTradeInSubmit:function(b){this.hasPendingRequest||c(b.currentTarget).hasClass("a-button-disabled")||(this.loadingSpinnerShow(),this.hasPendingRequest=!0,b=this.instantPaymentEligible?"ip":"nip",this.customerIpPreference||(this.customerIpPreference=a.instantPaymentNow),this.instantPaymentMixed&&(b="mb"),l.post(this.tradeInSubmitUrl+b,{params:{requestToken:this.getCsrfTokenByKey(a.csrfSubmitRequestKey),
customerIpPreference:this.customerIpPreference,currentAsin:h.getCurrentAsin()},success:c.proxy(function(b){this.tradeInSubmitData=b;try{if(this.tradeInSubmitData.hasOwnProperty("mfaUrl")&&this.tradeInSubmitData.mfaUrl){h.redirectToMFA(this.tradeInSubmitData.mfaUrl);return}t.sessionStorage&&(t.sessionStorage.removeItem("tradein-state"),this.promotionEligible&&(this.promosApplied.push({productGroup:this.tradeInProductGroup,applied:!0}),t.sessionStorage.setItem("tradein-promos-applied",JSON.stringify(this.promosApplied))))}catch(c){h.recordError(c,
a.sessionStorageAccessErrorMsg)}l.trigger("tanookiSuccess");this.loadingSpinnerHide();this.hasPendingRequest=!1;this.updateLaunchButtonText();this.navCurrentView=a.successfulViewClass;this.createView()},this),error:c.proxy(function(b){this.hasPendingRequest=!1;b.hasOwnProperty("http")&&b.http.status===a.maxTradeInItemQuantityStatusCode?this.handleMaxQuantityError():this.handleRequestError(b,"TradeIn submit error","Error encountered during TradeIn submit request")},this)}))},addNavHistory:function(a){this.navHistory.push(a)},
popNavHistory:function(){if(1<this.navHistory.length)return this.navHistory.pop(),this.navHistory.pop()},createView:function(){this.hideAllViews();switch(this.navCurrentView){case a.searchResultsListViewClass:this.recordRefTag(a.refTagSearchItemsView);this.createSearchResultsView();break;case a.selectedItemConditionViewClass:this.recordRefTag(a.refTagConditionView);this.createConditionView();break;case a.selectedItemsConfirmationViewClass:this.recordRefTag(a.refTagConfirmationView);this.createConfirmationView();
break;case a.successfulViewClass:this.recordRefTag(a.refTagSuccessfulView);this.createSuccessfulView();break;default:this.recordRefTag(a.refTagListItemsView),this.createEligibleListView()}},createEligibleListView:function(){var b=this.config;if(-1===c.inArray(this.navCurrentView,this.boundedViews)){var d=e.bindDataToTemplate(this.eligibleListViewTemplate,{instantPayable:this.config.hasOwnProperty("instantPayable")?this.config.instantPayable:!1});d.find(a.eligibleItemsCountId).html(b.eligibleItems.length);
var p=d.find(a.eligibleItemListClass);this.createTemplatesByIterable(b.eligibleItems,this.eligibleItemTemplate,p);if(0<this.selectedSearchResultItems.length){var q=0,g=d.find(".tradein-search-item-list");c.each(this.selectedSearchResultItems,c.proxy(function(a,b){if(this.config.hasOwnProperty("validTradeInItemTypes")&&-1===c.inArray(b.tradeInItemType,this.config.validTradeInItemTypes))return!0;b.fromSearch=!0;a=e.bindDataToTemplate(this.eligibleItemTemplate,b);a.data("templateModel",b);g.append(a);
q++},this));0<q&&(d.find(".search-result-wrapper").addClass("active"),d.find("#searchedSelectedItems").html(q))}this.tradeInWrapper.append(d);this.hasInitiallyLoaded||c.each(b.eligibleItems,c.proxy(function(a,b){b.selected&&this.createSelectedItem(b)},this));var f=this;c.each(this.tradeInWrapper.find(".selectable-wrapper .selectable-item"),function(){var b=c(this),w=f.getDataModel(b);c.each(f.selectedEligibleItems,function(c,e){b.hasClass("disabled")||e.asin!==w.asin||e.deviceId!==w.deviceId||(b.addClass("selected").removeClass("disabled"),
b.find('input[type\x3d"checkbox"]').prop("checked",!0).prop("disabled",!1),f.toggleEligibleItemsSelectableStateByAsin(e.asin,!1),d.find(".a-button-disabled").removeClass("a-button-disabled").find("button").prop("disabled",!1),f.toggleReviewTradeInItemsSubmitState(a.itemSelectEligibleContext))})});this.bindAutoComplete();this.boundedViews.push(this.navCurrentView);this.hasInitiallyLoaded=!0}p=this.tradeInWrapper.find(".no-eligible-items");0===b.eligibleItems.length&&0===this.selectedEligibleItems.length?
p.show():p.hide();this.updateSelectedCountValueHeader();this.validateMaxSelectedItems();this.tradeInWrapper.find(a.eligibleListViewClass).show();this.navHistory.push(this.navCurrentView)},createConditionView:function(){-1===c.inArray(this.navCurrentView,this.boundedViews)&&(c.each(this.selectedEligibleItems,c.proxy(function(b,d){var p=e.bindDataToTemplate(this.selectedItemConditionViewTemplate,d);this.updateConditionViewHeaderCount(p,b+1);b="";for(var q=d.tradeInQuestions,g=0;g<q.length;g++){for(var f=
q[g],r="",w=e.bindDataToTemplate(this.questionRadioButtonTemplate,f),z=0;z<f.choices.length;z++)r+=e.bindDataToTemplate(this.radioButtonTemplate,{questionId:f.id},f.choices[z])[0].outerHTML;w.find(".tradein-question-choice-list").append(r);b+=w[0].outerHTML}this.config.hasOwnProperty("deviceTradeInFlavor")&&"promo_only"===this.config.deviceTradeInFlavor||(b+=e.bindDataToTemplate(this.questionRadioTemplate)[0].outerHTML);p.find(".conditions-question-list").append(b);for(var x in d.tradeInQuestionResponses)if(d.tradeInQuestionResponses.hasOwnProperty(x)){var k=
d.tradeInQuestionResponses[x];x===a.appraisalInputName?p.find('input[name\x3d"'+x+'"][value\x3d"'+k+'"]').prop("checked",!0):p.find('button[name\x3d"'+x+'"]').each(function(){c(this).val()===k&&c(this).closest(".a-button-toggle").addClass("a-button-selected").attr("aria-checked",!0)})}p.attr("id","conditionGrade_"+d.asin);x=h.getSortedConditionTradeInValues(d);b=p.find(".conditions-question-list .adjusted-pricing-range");b.find("#adjustedPriceLow").html(h.formatCurrency(x[0]));b.find("#adjustedPriceHigh").html(h.formatCurrency(x[x.length-
1]));b.removeClass("aok-hidden");this.tradeInWrapper.append(p);p.data("templateModel",d)},this)),this.boundedViews.push(this.navCurrentView));this.getIsAllGraded()?(this.tradeInWrapper.find(a.eligibleListViewClass).show(),this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))):c.each(this.selectedEligibleItems,c.proxy(function(b,d){b="#conditionGrade_"+d.asin;var c=this.tradeInWrapper.find(b);if(0!==c.length)if(d.hasBeenGraded)c.removeClass("active");
else return c.addClass("active").show(),c.find('input[name\x3d"'+a.appraisalInputName+'"][value\x3d"'+a.appraisalAccept+'"]').prop("checked",!0),this.toggleNextConditionSubmitState(d),this.navHistory.push(b),!1},this))},createConfirmationView:function(){this.tradeInWrapper.find(a.selectedItemsConfirmationViewClass).remove();this.instantPaymentEligible=this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")?this.tradeInReviewData.instantPaymentEligible:!1;this.instantPaymentMixed=this.tradeInReviewData.hasOwnProperty("orderTotalPaidInstantly")&&
0<this.tradeInReviewData.orderTotalPaidInstantly&&0<(this.tradeInReviewData.hasOwnProperty("orderTotalPaidOnGrading")&&this.tradeInReviewData.orderTotalPaidOnGrading);this.promotionEligible=this.tradeInReviewData.hasOwnProperty("promotionEligible")?this.tradeInReviewData.promotionEligible:!1;var b=this.instantPaymentEligible?a.refTagReviewInstantPaymentView:a.refTagReviewNonInstantPaymentView;this.instantPaymentMixed&&(b=a.refTagReviewMixedBagPaymentView);this.recordRefTag(b);var d=this.tradeInReviewData.hasOwnProperty("sanitizedItemsList")&&
c.isArray(this.tradeInReviewData.sanitizedItemsList)?this.tradeInReviewData.sanitizedItemsList:[],b=e.bindDataToTemplate(this.selectedItemsConfirmationViewTemplate,{instantPayable:this.instantPaymentEligible,promotionEligible:this.promotionEligible});if(this.tradeInReviewData.hasOwnProperty("promotionEligibilityText")){var p="";c.each(this.tradeInReviewData.promotionEligibilityText,function(a,b){p+=b});b.find(".tradeInPromotion #promotionText").html(p)}var q="",n=!1;c.each(this.selectedEligibleItems,
c.proxy(function(a,b){var f=!1;c.each(d,function(a,r){if(r.asin===b.asin)return f=!0,b.instantPayable=r.instantPayable,b.tradeInValue=r.tradeInValue,!1});f||(n=!0,this.tradeInReviewData.hasOwnProperty("nonTradeableItems")&&this.isItemInListByAsin(b,this.tradeInReviewData.nonTradeableItems)?b.nonTradeableItems=!0:this.tradeInReviewData.hasOwnProperty("qtyLimitExceedItems")&&this.isItemInListByAsin(b,this.tradeInReviewData.qtyLimitExceedItems)?b.qtyLimitExceedItems=!0:b.unknownErrorState=!0);q+=e.bindDataToTemplate(this.itemConfirmationTemplate,
b)[0].outerHTML},this));b.find(".tradein-confirmation-item-list").append(q);var f=!1;this.tradeInReviewData.hasOwnProperty("defaultReturnAddressId")&&this.tradeInReviewData.defaultReturnAddressId?this.tradeInReviewData.hasOwnProperty("freeShipping")&&this.tradeInReviewData.freeShipping?n&&b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-updates").clone()).addClass("active"):(f=!0,b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-invalid-address-error").clone()).addClass("active")):
(f=!0,b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-address-error").clone()).addClass("active"),b.find(".tradein-appraisal-info").hide());this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,b.find("#weWantYouToKnow #weWantYouToKnowExpanderContent").append(this.dropOffBannerNoLinkTemplate));b.find(".tradeInShipDate").html(this.tradeInReviewData.shipByDateString);b.find(".labelEmail").html(this.tradeInReviewData.emailAddress);
b.find("#tradeInTotalValue").html(h.formatCurrency(this.tradeInReviewData.orderTotalGC));b.find(".selectedItemTotalCount").html(d.length);b.find("#returnAddress").html(e.bindDataToTemplate(c("#addressLineTemplate"),this.tradeInReviewData.defaultReturnAddress));this.tradeInWrapper.append(b);this.toggleMixedBasketElements(b);if(f||0===d.length)b.find(".payment-breakdown").hide(),k(a.tradeInWrapperClass+" #confirmTradeInSubmit").disable();this.instantPaymentEligible&&this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&
this.tradeInReviewData.isMFAMarketplace&&(g.isEnabled&&this.tradeInWrapper.find(".instantPaymentPreference-wrapper").removeClass("aok-hidden"),this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"));this.navHistory.push(this.navCurrentView)},createSuccessfulView:function(){var b=e.bindDataToTemplate(this.successfulTradeInViewTemplate,{instantPayable:this.customerIpPreference===a.instantPaymentNow&&this.instantPaymentEligible,promotionEligible:this.promotionEligible});
l.objectIsEmpty(this.tradeInSubmitData)||(b.find("#tradeInTotalValue").html(h.formatCurrency(this.tradeInSubmitData.totalAmount)),b.find(".tradeInShipDate").html(this.tradeInSubmitData.shipByDate),b.find(".labelEmail").html(this.tradeInSubmitData.customerEmailAddress),b.find(".customerEmail").html(this.tradeInSubmitData.customerEmailAddress));this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,this.createNearbyProcessorExpander(),
b.find(".content-wrapper").append(this.dropOffLocationExpander));this.tradeInWrapper.append(b);this.toggleMixedBasketElements(b)},createSearchResultsView:function(){this.tradeInWrapper.find(a.searchResultsListViewClass).remove();var b=e.bindDataToTemplate(this.searchResultsListViewTemplate);b.find("#searchTerm").html(this.tradeInSearchCurrentCacheEntry.term);if(this.tradeInSearchCurrentCacheEntry.hasOwnProperty("eligibleItems")){var d=this.tradeInSearchCurrentCacheEntry.eligibleItems,p=b.find(a.searchResultListClass);
this.createTemplatesByIterable(d,this.searchResultItemTemplate,p);p.bind("scroll",c.proxy(this.handleSearchScroll,this))}this.tradeInWrapper.append(b);this.tradeInWrapper.find(".search-input").val(this.tradeInSearchCurrentCacheEntry.term);this.bindAutoComplete();this.validateMaxSelectedItems();this.navHistory.push(this.navCurrentView)},createTemplatesByIterable:function(a,d,p){c.each(a,c.proxy(function(a,b){a=e.bindDataToTemplate(d,b);a.data("templateModel",b);p.append(a)},this))},createSelectedItem:function(b){if(!this.isItemInListByAsin(b,
this.selectedEligibleItems)){var d={hasBeenGraded:!1,gradedCondition:null,tradeInQuestions:this.getQuestionsByItem(b),tradeInValue:b.tradeInValue,tradeInQuestionResponses:{appraisal:a.appraisalAccept}},d=c.extend(!0,{},d,b);this.selectedEligibleItems.push(d)}},createReturnAddressInstance:function(a){if(this.tradeInReviewData&&0<a.length)if(0===a.children().length){for(var d in this.tradeInReviewData.returnAddresses)if(this.tradeInReviewData.returnAddresses.hasOwnProperty(d)){var p=this.tradeInReviewData.returnAddresses[d];
p.formalAddress=e.bindDataToTemplate(c("#addressLineFormalTemplate"),p);var q=e.bindDataToTemplate(c("#addressLineItemTemplate"),p),g=this.tradeInReviewData.defaultReturnAddressId===p.addressId;q.find('input[type\x3d"radio"]').val(p.addressId).prop("checked",g);q.data("templateModel",p);a.append(q)}a.delegate('input[type\x3d"radio"]',"change",c.proxy(this.handleReturnAddressChange,this))}else a=a.find('input[type\x3d"radio"]'),c.each(a,c.proxy(function(a,b){a=c(b);a.prop("checked",a.val()===this.tradeInReviewData.defaultReturnAddressId)},
this))},saveState:function(){try{t.sessionStorage&&t.sessionStorage.setItem("tradein-state",JSON.stringify({selectedSearchResultItems:this.selectedSearchResultItems}))}catch(b){h.recordError(b,a.sessionStorageAccessErrorMsg)}},cleanState:function(){this.selectedEligibleItems=[];this.selectedSearchResultItems=[];this.navHistory=[];this.boundedViews=[];this.navCurrentView=null;this.hasInitiallyLoaded=!1;c(a.searchSuggestionsClass).remove()},restoreFromState:function(){try{if(t.sessionStorage){var b=
t.sessionStorage.getItem("tradein-state");b&&(this.selectedSearchResultItems=this.extractStateFromStorage(b).selectedSearchResultItems);var d=t.sessionStorage.getItem("tradein-promos-applied");d&&(this.promosApplied=this.extractStateFromStorage(d))}}catch(c){h.recordError(c,a.sessionStorageAccessErrorMsg)}},extractStateFromStorage:function(a){try{var d=l.parseJSON(a);if(!l.objectIsEmpty(d))return d}catch(c){h.recordError(c,"SessionStorage state JSON parse error")}},hideAllViews:function(){this.tradeInWrapper.children().each(function(){c(this).hide()})},
goToView:function(){this.saveState();this.createView()},handleSearchScroll:function(b){var d=this.tradeInWrapper.find(a.searchResultListClass);if(0<d.length){b=d.height();b=d.scrollTop()+b;var d=d[0].scrollHeight-120,c=Math.ceil(this.tradeInSearchCurrentCacheEntry.totalAvailableResults/a.tradeInSearchPageSize);!this.searchIsInProgress&&this.tradeInSearchCurrentCacheEntry.currentPageIndex<c&&b>=d&&(this.tradeInSearchCurrentCacheEntry.currentPageIndex+=1,this.doTradeInSearch(a.tradeInSearchResultsScrollContext))}},
handleSearchFormSubmit:function(b){b.preventDefault();b=c(b.currentTarget);var d=b.find(".search-input");if(!d.is("input")&&(d=b.find(".search-input input"),!d.is("input")))return;if(b=l.trim(d.val()))this.tradeInSearchCurrentCacheEntry=this.getSearchResultsCacheEntry(b),0===this.tradeInSearchCurrentCacheEntry.eligibleItems.length?this.doTradeInSearch(a.tradeInSearchResultsLoadContext):(this.navCurrentView=a.searchResultsListViewClass,this.createView())},handleSearchItemRemoveClick:function(b){b=
c(b.currentTarget);b.closest(".selectable-item").hasClass("disabled")||(b=this.getDataModel(b),this.recordRefTag(a.refTagSearchItemRemoveClick),this.isItemInListByAsin(b,this.selectedEligibleItems)&&this.doTradeInItemRemove(b),this.spliceItemFromList(b,this.selectedSearchResultItems),this.spliceItemFromList(b,this.selectedEligibleItems),this.handleSearchContinueButtonClick())},handleSearchContinueButtonClick:function(){this.tradeInSearchCurrentCacheEntry=null;this.tradeInWrapper.find(a.eligibleListViewClass).remove();
delete this.boundedViews[this.boundedViews.indexOf(a.eligibleListViewClass)];this.navCurrentView=this.navViews.eligibleListView;this.addNavHistory(this.navCurrentView);this.goToView()},handleContinueButtonClick:function(b){b=c(b.currentTarget);var d=this.getDataModel(b);this.recordRefTag(a.refTagConditionContinueClick);this.loadingSpinnerShow();b={asin:d.asin,condition:d.gradedCondition,returnOption:d.tradeInQuestionResponses.appraisal,requestToken:this.getCsrfTokenByKey(a.csrfSaveGradedItemKey)};
d.hasOwnProperty("deviceId")&&d.deviceId&&(b.deviceId=d.deviceId);l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b);this.loadingSpinnerHide();d.hasBeenGraded=!0;this.recordRefTag(a.refTagGradedConditionClick+d.gradedCondition.toLowerCase());this.getIsAllGraded()?(this.tradeInWrapper.find(a.continueButtonClass).each(function(){c(this).removeClass("a-button-disabled").addClass("active");c(this).find("button").prop("disabled",
!1)}),this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))):(this.navCurrentView=this.navViews.selectedItemConditionView,this.goToView())},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},this)})},handleBackButtonClick:function(){var b=this.popNavHistory();if(b)if(this.navCurrentView=b,this.addNavHistory(b),
this.recordRefTag(a.refTagBackClick),b===a.eligibleListViewClass)this.resetEligibleListView(),this.createView();else{this.hideAllViews();var d=this.tradeInWrapper.find(b);-1!==b.indexOf("conditionGrade_")&&(this.tradeInWrapper.find(".tradein-selected-item-condition-view").each(function(){c(this).removeClass("active")}),d.addClass("active"),b=b.split("_"),1<b.length&&this.restoreViewButtonState(d,b[1]));d.show();d.find(".selectable-wrapper").scrollTop(0)}},handleSelectableItemClick:function(b,d){var e=
c(b.currentTarget);b=e.closest(".selectable-item");if(!b.hasClass("disabled")){var q=this.getDataModel(b);if(q){if(b.hasClass("selected"))d===a.itemSelectSearchContext&&this.spliceItemFromList(q,this.selectedSearchResultItems),d===a.itemSelectEligibleContext&&this.isItemInListByAsin(q,this.selectedEligibleItems)&&this.doTradeInItemRemove(q),this.spliceItemFromList(q,this.selectedEligibleItems),b.removeClass("selected"),this.toggleEligibleItemsSelectableStateByAsin(q.asin,!0),this.recordRefTag(a.refTagItemDeSelect),
this.hideAlert();else{if(this.validateMaxGiftCardAmount(q)){this.showAlert(this.alertMaxGCValueWarningClass,b);e.prop("checked",!1);return}d!==a.itemSelectSearchContext||this.isItemInListByAsin(q,this.selectedSearchResultItems)||(this.recordRefTag(a.refTagSearchItemSelect),e=c.extend({},q),e.fromSearch=!0,this.selectedSearchResultItems.push(e));this.createSelectedItem(q);b.addClass("selected");this.toggleEligibleItemsSelectableStateByAsin(q.asin,!1);this.recordRefTag(a.refTagItemSelect)}this.updateSelectedCountValueHeader();
this.validateMaxSelectedItems();this.toggleReviewTradeInItemsSubmitState(d);this.saveState()}}},handleQuestionButtonClick:function(a){var d=c(a.currentTarget),e=d.find("button"),d=this.getDataModel(d);d.tradeInQuestionResponses[e.attr("name")]=e.val();this.toggleNextConditionSubmitState(d,c(a.currentTarget).closest(".tradein-question-wrapper"))},handleAppraisalRadioChange:function(b){b=c(b.currentTarget);var d=this.getDataModel(b);d.tradeInQuestionResponses[b.attr("name")]=b.val();this.recordRefTag(b.val()===
a.appraisalReturn?a.refTagAppraisalReturn:a.refTagAppraisalAccept);this.toggleNextConditionSubmitState(d)},handleIpPreferenceRadioChange:function(b){this.customerIpPreference=c(b.currentTarget).val();this.customerIpPreference===a.instantPaymentNow&&this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace?this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"):this.tradeInWrapper.find(".instantPaymentPreference-mfa").addClass("aok-hidden")},
handleConfirmDeleteClick:function(b){this.recordRefTag(a.refTagDeleteClick);var d=c(b.currentTarget).data("asin"),e=null;c.each(this.selectedEligibleItems,c.proxy(function(a,b){if(b.asin===d)return e=b,this.tradeInWrapper.find("#conditionGrade_"+d).remove(),this.selectedEligibleItems.splice(a,1),!1},this));e&&(this.loadingSpinnerShow(),l.post(this.tradeInRemoveItemUrl,{params:{asin:e.asin,decline:!0,requestToken:this.getCsrfTokenByKey(a.csrfRemoveRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfRemoveRequestKey,
b);this.loadingSpinnerHide();c.each(this.config.eligibleItems,function(a,b){b.asin===d&&(b.condition=null)});0===this.selectedEligibleItems.length?(k(a.eligibleListViewClass+" "+a.reviewTradeInItemsSubmitId).disable(),this.tradeInWrapper.find(a.eligibleListViewClass+" .selectable-item").each(function(){c(this).removeClass("selected").removeClass("disabled");c(this).find('input[type\x3d"checkbox"]').prop("checked",!1).prop("disabled",!1)}),this.resetEligibleListView(),this.navCurrentView=this.navViews.eligibleListView,
this.goToView()):this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn remove item from past purchase list error","Error encountered during TradeIn remove item from past purchases request")},this)}))},handleConfirmChangeClick:function(b){this.hideAllViews();this.navCurrentView=this.navViews.selectedItemConditionView;this.recordRefTag(a.refTagChangeConditionClick);
var d=c(b.currentTarget).data("asin");b=this.tradeInWrapper.find("#conditionGrade_"+d);var e=1;c.each(this.selectedEligibleItems,function(a,b){if(b.asin===d)return e=a+1,!1});this.updateConditionViewHeaderCount(b,e);b.find(a.backButtonClass).hide();b.find(a.continueButtonClass).addClass("active");b.addClass("active").show();b.find(".scrollable-list").scrollTop(0);this.restoreViewButtonState(b,d)},handleLoginPrompt:function(){this.recordRefTag(a.refTagLogInPrompt);var b=this.tradeInWrapper.find(this.navCurrentView+
" .content-wrapper"),d=c("#alertTemplates "+a.alertPromptLoginClass).clone();b.html("").append(d).addClass("logged-out-message")},handleRequestError:function(b,d,e){this.loadingSpinnerHide();b.http.status===a.unauthorizedCode?this.handleLoginPrompt():(h.recordError(d,e),this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").prepend(c(".tradein-templates .tradein-general-error").clone()).addClass("active"))},handleReturnAddressChange:function(b){this.recordRefTag(a.refTagReturnAddressUpdateRequest);
this.loadingSpinnerShow();l.post(this.tradeInReviewUrl,{params:{addressId:b.val(),requestToken:this.getCsrfTokenByKey(a.csrfReviewRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfReviewRequestKey,b);this.loadingSpinnerHide();this.tradeInReviewData=b;this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn return address error","Error encountered during TradeIn return address update request")},
this)})},handleMaxQuantityError:function(){this.loadingSpinnerHide();this.selectedEligibleItems=[];this.resetEligibleListView();this.navCurrentView=this.navViews.eligibleListView;this.goToView();this.showAlert(a.alertMaxItemQuantityBannerClass)},toggleEligibleItemsSelectableStateByAsin:function(b,d){c.each(this.tradeInWrapper.find("li.tradein-eligible-item .selectable-item"),c.proxy(function(e,g){g=c(g);e=g.find('input[type\x3d"checkbox"]');var h=this.getDataModel(g);h&&h.asin===b&&(d?(g.find(".tradein-item-info "+
a.alertMaxItemQuantityClass).remove(),g.removeClass("disabled").removeClass("maxasin"),e.prop("disabled",!1)):g.hasClass("selected")||d||(g.addClass("disabled").addClass("maxasin"),e.prop("disabled",!0)))},this))},toggleAllEligibleItemsSelectableState:function(a){c.each(this.tradeInWrapper.find("li .selectable-item"),c.proxy(function(d,e){e=c(e);d=e.find('input[type\x3d"checkbox"]');e.hasClass("selected")||e.hasClass("maxasin")||(a?(e.removeClass("disabled"),d.prop("disabled",!1)):(e.addClass("disabled"),
d.prop("disabled",!0)))},this))},toggleReviewTradeInItemsSubmitState:function(b){b=k(b===a.itemSelectSearchContext?a.tradeInWrapperClass+" "+a.searchResultsListViewClass+" "+a.continueButtonClass:a.tradeInWrapperClass+" "+a.reviewTradeInItemsSubmitId);0<this.selectedEligibleItems.length?b.enable():b.disable()},toggleNextConditionSubmitState:function(b,d){var e=[a.appraisalInputName];c.each(b.tradeInQuestions,function(a,b){b.hasOwnProperty("id")&&e.push(b.id)});var g=!0,h=!1;c.each(e,c.proxy(function(a,
r){"Unacceptable"===b.tradeInQuestionResponses[r]&&(h=!0,g=!1);b.tradeInQuestionResponses.hasOwnProperty(r)||(g=!1)},this));h?this.showAlert(this.alertItemAcceptableClass,d):this.hideAlert();d=k(a.selectedItemConditionViewClass+".active "+a.continueButtonClass);g?(this.setGradedCondition(b),d.enable()):d.disable()},toggleMixedBasketElements:function(a){this.instantPaymentMixed?(a.find("#paidInstantAmount").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly)),a.find("#paidNonInstantAmount").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidOnGrading)),
a.find(".mixed-basket #tradeInTotalValue").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly)),a.find(".non-mixed-basket").hide(),a.find(".mixed-basket").show(),a.find(".paid-breakdown-wrapper").show()):(a.find(".non-mixed-basket").show(),a.find(".mixed-basket").hide(),a.find(".paid-breakdown-wrapper").hide())},restoreViewButtonState:function(a,d){c.each(this.selectedEligibleItems,c.proxy(function(e,g){if(g.asin===d){for(var h in g.tradeInQuestionResponses)if(g.tradeInQuestionResponses.hasOwnProperty(h)){var f=
g.tradeInQuestionResponses[h];a.find('input[type\x3d"radio"][name\x3d"'+h+'"]').each(function(){c(this).val()===f&&c(this).prop("checked",!0)})}this.toggleNextConditionSubmitState(g)}},this))},resetEligibleListView:function(){this.tradeInWrapper.find(a.selectedItemConditionViewClass).remove();delete this.boundedViews[this.boundedViews.indexOf(a.selectedItemConditionViewClass)];this.tradeInWrapper.find(a.eligibleListViewClass).remove();delete this.boundedViews[this.boundedViews.indexOf(a.eligibleListViewClass)]},
getTradeInTotalValue:function(){var a=0;c.each(this.selectedEligibleItems,function(d,c){a+=c.tradeInValue});return a},getIsAllGraded:function(){var a=!0;c.each(this.selectedEligibleItems,function(d,c){if(!c.hasBeenGraded)return a=!1});return a},getDataModel:function(a){return a.closest("*[data-template-model]").data("templateModel")},getConditionWeightageMap:function(a){var d=[],e={},g;for(g in a.conditionOfferMap)a.conditionOfferMap.hasOwnProperty(g)&&d.push([g,a.conditionOfferMap[g].tiv]);d.sort(function(a,
b){return b[1]-a[1]});c.each(d,function(a,b){e[b[0]]=a});return e},getSearchResultsCacheEntry:function(a){for(var d=0;d<this.searchResultsCache.length;d++){var c=this.searchResultsCache[d];if(c.term===a)return c}c={term:a,eligibleItems:[],currentPageSize:0,currentPageIndex:1,totalAvailableResults:0};this.searchResultsCache.push(c);return c},getQuestionsByItem:function(a){return this.config.hasOwnProperty("questionnaires")&&this.config.questionnaires[a.tradeInItemType]&&this.config.questionnaires[a.tradeInItemType].hasOwnProperty("questions")?
this.config.questionnaires[a.tradeInItemType].questions:[]},getCsrfTokenByKey:function(b){return this.config.hasOwnProperty(a.csrfKeyMap)&&this.config[a.csrfKeyMap][b]?this.config[a.csrfKeyMap][b]:""},isItemInListByAsin:function(a,d){for(var c=0;c<d.length;c++)if(d[c].asin===a.asin)return!0;return!1},setGradedCondition:function(b){var d=this.getConditionWeightageMap(b),e=[],g=null;c.each(b.tradeInQuestionResponses,function(b,r){b!==a.appraisalInputName&&e.push(d[r])});var k=l.reduce(e,function(a,
b){return b&&b>a?b:a},0);c.each(d,function(a,b){if(b===k)return g=a,!1});b.gradedCondition=g;b.tradeInValue=b.conditionOfferMap[g].tiv;var f=this.tradeInWrapper.find("#conditionGrade_"+b.asin);f.find("#estimatedTiv").html(h.formatCurrency(b.tradeInValue));var r=h.getSortedConditionTradeInValues(b);b=r.indexOf(b.tradeInValue);r.length&&-1!==b&&(f.find(".appraisal-choose-label").css("visibility","visible"),f.find(".appraisal-wrapper").css("visibility","visible"),f.find(".adjusted-pricing").each(function(){c(this).addClass("aok-hidden")}),
r=r.slice(0,b),0===r.length?(f.find(".appraisal-choose-label").css("visibility","hidden"),f.find(".appraisal-wrapper").css("visibility","hidden")):(1===r.length?(f=f.find(".adjusted-pricing-single"),f.find("#adjustedPriceLow").html(h.formatCurrency(r[0]))):(f=3<r.length?f.find(".adjusted-pricing-range"):f.find(".adjusted-pricing-double"),f.find("#adjustedPriceLow").html(h.formatCurrency(r[0])),f.find("#adjustedPriceHigh").html(h.formatCurrency(r[r.length-1]))),f.removeClass("aok-hidden")))},loadingSpinnerShow:function(){this.loadingSpinner.addClass("active")},
loadingSpinnerHide:function(){this.loadingSpinner.removeClass("active")},showAlert:function(a,d){this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").append(c("#alertTemplates "+a).clone()).addClass("active")},hideAlert:function(){this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").removeClass("active")},recordRefTag:function(a){a=this.tradeInRefTagUrl+this.tradeInRefTagPrefix+a;var d=a+"_"+this.tradeInProductGroup;this.doRecordRefTag(a);this.doRecordRefTag(d)},
doRecordRefTag:function(a){l.get(a,{error:function(a,b,c){h.recordError(b+"::"+c,"Error encountered during refTag record request")}})},spliceItemFromList:function(a,d){c.each(d,function(c,e){if(e.asin===a.asin)return d.splice(c,1),!1})},updateSelectedCountValueHeader:function(){0<this.promosApplied.length&&c.each(this.promosApplied,c.proxy(function(a,d){if(d.productGroup===this.tradeInProductGroup&&d.applied)return this.tradeInWrapper.find(".promo-text").hide(),this.tradeInWrapper.find(".promoText").hide(),
this.tradeInWrapper.find(".non-promo-text").show(),!1},this))},validateMaxSelectedItems:function(){this.selectedEligibleItems.length===a.maximumTradeInItemsCount?(this.toggleAllEligibleItemsSelectableState(!1),this.hasMaxItemsSelected=!0):(this.hideAlert(),this.hasMaxItemsSelected&&(this.toggleAllEligibleItemsSelectableState(!0),this.hasMaxItemsSelected=!1))},validateMaxGiftCardAmount:function(a){(a=this.getTradeInTotalValue()+a.tradeInValue>this.config.maxGiftCardAmount)||this.hideAlert();return a},
updateConditionViewHeaderCount:function(b,d){b.find(a.currentSelectedItemIndexId).html(d);b.find(a.selectedItemTotalCountId).html(this.selectedEligibleItems.length)},updateCsrfTokenByKey:function(b,d){d.hasOwnProperty(b)&&this.config.hasOwnProperty(a.csrfKeyMap)&&(this.config[a.csrfKeyMap][b]=d[b])},updateLaunchButtonText:function(){l.declarative.remove(c("#tradeInLaunchAction"),"launch-tanooki");var a=c(".tradein-instant-savings-launch-button"),d="#successfulNonIpButtonText";this.instantPaymentEligible&&
(d=this.promotionEligible?"#successfulIpWithPromotionButtonText":"#successfulIpNoPromotionButtonText");c.each(a,function(){var a=c(".tradein-templates "+d).clone();c(this).replaceWith(a)});a=c(".tradein-price-block");c.each(a,function(){var a=c(".tradein-templates "+d).clone();c(this).replaceWith(a)})}})});"use strict";u.when("A","a-modal","a-popover","trade-in-constants","trade-in-common-utils","trade-in-data-binder","trade-in-base-controller","ready").register("trade-in-controller",function(l,m,
k,a,h,e,g){function c(d){-1<d.indexOf(a.refTagPriceBlockPrefix)&&h.setRefTagPrefix(a.refTagPriceBlockPrefix);var c=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+h.getDeviceType()+"\x26ref_\x3d",e=h.getIngressButtonRefTag();h.recordRefTag(e,c,a.refTagButtonExperimentPreFix,h.getProductGroup());(c=h.getProductGroup())?(d=d+"_"+c,d=a.tradeInRouteBase+"getCustomerItems?deviceType\x3d"+h.getDeviceType()+"\x26productGroup\x3d"+c+"\x26ref_\x3d"+d):d=a.tradeInRouteBase+"generalerror?ref_\x3d"+(d+"_pg_missing");
(c=m.get(a.tradeInModalName))||(c=m.create(b("\x3cdiv /\x3e"),{url:d,name:a.tradeInModalName,header:h.getModalTitle(),width:700,cache:!1,padding:"none"}));c.show()}var b=l.$;h.captureTradeInContext();try{t.sessionStorage&&(sessionStorage.getItem(a.tanookiSessionStorageKey)&&(c(a.refTagPrefix+"auth_launch"),sessionStorage.removeItem(a.tanookiSessionStorageKey)),sessionStorage.getItem(a.priceBlockSessionStorageKey)&&(c(a.refTagPriceBlockPrefix+"auth_launch"),sessionStorage.removeItem(a.priceBlockSessionStorageKey)))}catch(d){t.ueLogError&&
t.ueLogError({message:d,logLevel:"ERROR",attribution:"tradein: session storage access blocked"})}l.declarative("launch-tanooki","click",function(b){var e=a.refTagPrefix,g=a.tanookiBuyboxMetric;b.data.ingressType===a.priceBlockIngressType&&(e=a.refTagPriceBlockPrefix,g=a.tanookiPriceblockMetric);h.setRefTagPrefix(e);c(e+"launch");h.recordMetric(g)});l.declarative("redirect-to-login","click",function(b){var c=h.getAuthPortalHandleFromHostname(),e=a.tanookiSessionStorageKey;b.data.ingressType===a.priceBlockIngressType&&
(e=a.priceBlockSessionStorageKey);h.redirectToAuth(c,e)});return g.extend({deviceType:h.getDeviceType(),authPortalAssocHandle:a.authPortalAssocHandle,searchInputClass:a.searchInputClass,alertMaxGCValueWarningClass:a.alertMaxGCValueWarningClass,alertMaxItemsWarningClass:a.alertMaxItemsWarningClass,alertItemAcceptableClass:a.alertItemAcceptableClass,init:function(){this.setConstants(a.tradeInModalName,h.getProductGroup(),h.getRefTagPrefix())},bindEvents:function(){this._super();l.declarative("edit-return-address",
"click",b.proxy(this.createReturnAddressPopover,this));l.declarative("return-to-shopping","click",b.proxy(function(){this.recordRefTag(a.refTagReturnToShopping);m.get(a.tradeInModalName).hide()},this));l.on("a:expander:weWantYouToKnow:toggle:expand",b.proxy(function(b){b=a.refTagWeWantYouToKnow;this.recordRefTag(b);this.instantPaymentMixed&&(b+="_mb");b+=this.tradeInReviewData.instantPaymentEligible?"_ip":"_nip";b+=this.tradeInReviewData.promotionEligible?"_p":"_np";this.recordRefTag(b)},this))},
getElements:function(){this.base=b(".a-popover-modal").filter(":visible");this._super()},createEligibleListView:function(){this._super();setTimeout(b.proxy(function(){this.tradeInWrapper.css("height","auto")},this),25)},createConfirmationView:function(){if(!this.tradeInReviewData.promotionEligible&&this.config.hasOwnProperty("deviceTradeInFlavor")&&"promo_only"===this.config.deviceTradeInFlavor){var a=e.bindDataToTemplate(b("#promoOnlyValidationErrorView"));this.tradeInWrapper.append(a)}else this._super(),
a=this.tradeInWrapper.find(".tradein-selected-items-confirmation-view"),a.find("#weWantYouToKnow a.a-link-expander").click(),this.instantPaymentMixed||a.find(this.instantPaymentEligible?".ip-eligible":".nip-eligible").show()},createReturnAddressPopover:function(){this.recordRefTag(a.refTagReturnAddressUpdateView);k.create(this.tradeInWrapper.find(".know-list:visible #editReturnAddress"),{name:"returnAddressUpdate",dataStrategy:"inline",inlineContent:b("#returnAddressPopoverTemplate").html(),width:400,
position:"triggerTop",activate:"onclick"}).show();var c=b(".a-popover.a-declarative.a-arrow-top:visible .tradein-popover-address-container");this.createReturnAddressInstance(c)},createNearbyProcessorExpander:function(){this.recordRefTag(a.refTagNearbyProcessorsDesktop);var b=this.dropOffLocationExpander.find("#dropOffLocationListExpanderTemplate"),c=b.find("#dropOffLocationListExpander"),e=this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+
this.tradeInReviewData.defaultReturnAddress.postalCode;b.find(".customerAddress").html(e);h.createNearbyProcessorsList(this.offlineDropOffLocations,c,b)},handleReturnAddressChange:function(a){a=b(a.currentTarget);k.get("returnAddressUpdate").hide();this._super(a)},updateSelectedCountValueHeader:function(){var a=this.selectedEligibleItems.length;if(0===a)this.tradeInWrapper.find(".select-header.promo-text").show(),this.tradeInWrapper.find(".count-value-header").hide();else{this.tradeInWrapper.find(".select-header.promo-text").hide();
var b=this.tradeInWrapper.find(".count-value-header");b.find("#selectedItemTotalCount").html(a);b.find("#tradeInTotalValue").html(h.formatCurrency(this.getTradeInTotalValue()));b.show()}this._super()}})});"use strict";u.when("A","trade-in-controller","ready").register("trade-in-controller-factory",function(l,m){return{ctrlInstance:null,getInstance:function(){this.ctrlInstance||(this.ctrlInstance=new m);return this.ctrlInstance}}});var v=function(){return function(l){function m(a,b){return a.classList?
a.classList.contains(b):(new RegExp("\\b"+b+"\\b")).test(a.className)}function k(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)}function a(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c)}function h(a,b,c,e){k(e||document,b,function(b){for(var w,e=b.target||b.srcElement;e&&!(w=m(e,a));)e=e.parentElement;w&&c.call(e,b)})}if(document.querySelector){var e={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(a,
b){b=b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26");b=new RegExp("("+b.split(" ").join("|")+")","gi");return'\x3cdiv class\x3d"autocomplete-suggestion" data-val\x3d"'+a+'"\x3e'+a.replace(b,"\x3cb\x3e$1\x3c/b\x3e")+"\x3c/div\x3e"},onSelect:function(){}},g;for(g in l)l.hasOwnProperty(g)&&(e[g]=l[g]);var c="object"==typeof e.selector?[e.selector]:document.querySelectorAll(e.selector);for(l=0;l<c.length;l++){var b=c[l];b.sc=document.createElement("div");b.sc.className="autocomplete-suggestions "+e.menuClass;
b.autocompleteAttr=b.getAttribute("autocomplete");b.setAttribute("autocomplete","off");b.cache={};b.last_val="";b.updateSC=function(a,c){var d=b.getBoundingClientRect();if(b.sc.style.left=Math.round(d.left+(t.pageXOffset||document.documentElement.scrollLeft)+e.offsetLeft)+"px",b.sc.style.top=Math.round(d.bottom+(t.pageYOffset||document.documentElement.scrollTop)+e.offsetTop)+"px",b.sc.style.width=Math.round(d.right-d.left)+"px",!a&&(b.sc.style.display="block",b.sc.maxHeight||(b.sc.maxHeight=parseInt((t.getComputedStyle?
getComputedStyle(b.sc,null):b.sc.currentStyle).maxHeight)),b.sc.suggestionHeight||(b.sc.suggestionHeight=b.sc.querySelector(".autocomplete-suggestion").offsetHeight),b.sc.suggestionHeight))c?(a=b.sc.scrollTop,c=c.getBoundingClientRect().top-b.sc.getBoundingClientRect().top,0<c+b.sc.suggestionHeight-b.sc.maxHeight?b.sc.scrollTop=c+b.sc.suggestionHeight+a-b.sc.maxHeight:0>c&&(b.sc.scrollTop=c+a)):b.sc.scrollTop=0};k(t,"resize",b.updateSC);document.body.appendChild(b.sc);h("autocomplete-suggestion",
"mouseleave",function(){var a=b.sc.querySelector(".autocomplete-suggestion.selected");a&&setTimeout(function(){a.className=a.className.replace("selected","")},20)},b.sc);h("autocomplete-suggestion","mouseover",function(){var a=b.sc.querySelector(".autocomplete-suggestion.selected");a&&(a.className=a.className.replace("selected",""));this.className+=" selected"},b.sc);h("autocomplete-suggestion","mousedown",function(a){if(m(this,"autocomplete-suggestion")){var c=this.getAttribute("data-val");b.value=
c;e.onSelect(a,c,this);b.sc.style.display="none"}},b.sc);b.blurHandler=function(){try{var a=document.querySelector(".autocomplete-suggestions:hover")}catch(c){a=0}a?b!==document.activeElement&&setTimeout(function(){b.focus()},20):(b.last_val=b.value,b.sc.style.display="none",setTimeout(function(){b.sc.style.display="none"},350))};k(b,"blur",b.blurHandler);var d=function(a){var c=b.value;if(b.cache[c]=a,a.length&&c.length>=e.minChars){for(var d="",f=0;f<a.length;f++)d+=e.renderItem(a[f],c);b.sc.innerHTML=
d;b.updateSC(0)}else b.sc.style.display="none"};b.keydownHandler=function(a){var c=t.event?a.keyCode:a.which;if((40==c||38==c)&&b.sc.innerHTML){var d,f=b.sc.querySelector(".autocomplete-suggestion.selected");return f?(d=40==c?f.nextSibling:f.previousSibling,d?(f.className=f.className.replace("selected",""),d.className+=" selected",b.value=d.getAttribute("data-val")):(f.className=f.className.replace("selected",""),b.value=b.last_val,d=0)):(d=40==c?b.sc.querySelector(".autocomplete-suggestion"):b.sc.childNodes[b.sc.childNodes.length-
1],d.className+=" selected",b.value=d.getAttribute("data-val")),b.updateSC(0,d),!1}27==c?(b.value=b.last_val,b.sc.style.display="none"):(13==c||9==c)&&(f=b.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=b.sc.style.display&&(e.onSelect(a,f.getAttribute("data-val"),f),setTimeout(function(){b.sc.style.display="none"},20))};k(b,"keydown",b.keydownHandler);b.keyupHandler=function(a){a=t.event?a.keyCode:a.which;if(!a||(35>a||40<a)&&13!=a&&27!=a){var c=b.value;if(c.length>=e.minChars){if(c!=
b.last_val){if(b.last_val=c,clearTimeout(b.timer),e.cache){if(c in b.cache)return void d(b.cache[c]);for(a=1;a<c.length-e.minChars;a++){var g=c.slice(0,c.length-a);if(g in b.cache&&!b.cache[g].length)return void d([])}}b.timer=setTimeout(function(){e.source(c,d)},e.delay)}}else b.last_val=c,b.sc.style.display="none"}};k(b,"keyup",b.keyupHandler);b.focusHandler=function(a){b.last_val="\n";b.keyupHandler(a)};e.minChars||k(b,"focus",b.focusHandler)}this.destroy=function(){for(var b=0;b<c.length;b++){var d=
c[b];a(t,"resize",d.updateSC);a(d,"blur",d.blurHandler);a(d,"focus",d.focusHandler);a(d,"keydown",d.keydownHandler);a(d,"keyup",d.keyupHandler);d.autocompleteAttr?d.setAttribute("autocomplete",d.autocompleteAttr):d.removeAttribute("autocomplete");document.body.removeChild(d.sc)}}}}}();!function(){"function"==typeof define&&define.amd?define("autoComplete",function(){return v}):"undefined"!=typeof module&&module.exports?module.exports=v:t.autoComplete=v}();"use strict";u.when("A","ready").register("tradein-desktop-side-sheet",
function(l){var m,k=l.$,a,h,e;return{initialize:function(){a=k("\x3cdiv id\x3d'a-popover-lgtbox' class\x3d'a-declarative attach-popover tradein-lgtbox' data-action\x3d'a-popover-floating-close'\x3e\x3c/div\x3e");a.hide();a.appendTo(document.body);a.click(this.close);e=k('\x3cdiv id\x3d"tradein-desktop-side-sheet" class\x3d"a-section"\x3e\x3c/div\x3e');e.addClass("aok-hidden");k('\x3cdiv class\x3d"a-spinner-wrapper sidesheet-spinner"\x3e\x3cspan class\x3d"a-spinner a-spinner-medium"\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(e);
e.appendTo(document.body);k(document).unbind("keydown",this.onKeyDown);k(document).keydown(this.onKeyDown);m=this.close},onKeyDown:function(a){27===a.which&&m()},close:function(){l.trigger("tanooki-trade-in-desktop-side-sheet-close");a.hide();k(e).animate({right:h},{duration:500,complete:function(){k(e).remove();k(a).remove();k("body").removeClass("scroll-disabled")}})},show:function(g,c){k(e).removeClass("aok-hidden");k(e).animate({right:"0"},500,"linear");k(e).find(".sidesheet-spinner").addClass("active");
a.show();k.when(g).done(function(a){k(e).find(".sidesheet-spinner").remove("active");k("#tradein-desktop-side-sheet").html(a);c&&"function"===typeof c&&c()});h=k(e).css("right")}}});"use strict";u.when("A","a-popover","trade-in-constants","trade-in-common-utils","trade-in-data-binder","trade-in-asin-category-selection-base-controller","tradein-desktop-side-sheet","ready").register("trade-in-wireless-asin-category-selection-controller",function(l,m,k,a,h,e,g){function c(b){var c=a.getIngressButtonRefTag();
a.recordTv2RefTag(c,n);b=k.refTagTv2+b;var e=a.getProductGroup(),x=a.getCurrentAsin();e?(c=b+"_"+e,c={deviceType:a.getDeviceType(),productGroup:e,ref_:c,currentAsin:x},c=d.param(c),c=k.tradeInRouteBase+"wirelessTradeInSearchRefinements?"+c):c=k.tradeInRouteBase+"generalerror?ref_\x3d"+(b+"_pg_missing");p=d.get(c);g.initialize();d("body").addClass("scroll-disabled");g.show(p,function(){f=!0;0<d("#tradein-desktop-side-sheet").find(".tradein-logged-out-view").length?a.recordTv2RefTag(k.refTagAuthRequired,
n):0<=b.indexOf("auth_launch")&&a.recordTv2RefTag(k.refTagAuthCompleted,n)})}function b(){f||a.recordTv2RefTag(k.refTagAuthRequired,n);var b=a.getAuthPortalHandleFromHostname();a.redirectToAuth(b,"launchAsinCategoryTradeIn");a.setStorefrontSessionStorage(q)}var d=l.$,p,q=!1,n=k.tradeInRouteBase+"recordRefTag?deviceType\x3d"+a.getDeviceType()+"\x26ref_\x3d",f=!1;a.captureTradeInContext();q=a.getStorefrontSessionStorage();a.shouldLaunchTanookiV2OnPageLoad()&&c("auth_launch");l.declarative("launch-tanooki-wireless",
"click",function(){c("launch")});l.declarative("launch-tanooki-v2","click",function(){c("launch")});l.declarative("launch-tanooki-v2-storefront","click",function(b){q=!0;a.updateTradeInContext(b.data);c("launch")});l.declarative("redirect-to-login-wireless","click",function(){b()});l.declarative("redirect-to-login-v2","click",function(){b()});return e.extend({deviceType:a.getDeviceType(),authPortalAssocHandle:k.authPortalAssocHandle,init:function(){this.setConstants(k.tradeInSideSheetName,a.getProductGroup(),
q)},bindEvents:function(){this._super();this.tradeInWrapper.delegate(".exit-sidesheet-button","click",d.proxy(function(){g.close()},this));this.tradeInWrapper.delegate(".return-to-shopping, #returnToShopping","click",d.proxy(function(){g.close()},this));l.off("tanooki-trade-in-desktop-side-sheet-close");l.on("tanooki-trade-in-desktop-side-sheet-close",d.proxy(function(){a.recordTv2RefTag(k.refTagExit+this.getCurrentViewForRefTag(),this.tradeInRefTagUrl,this.bifurcationRefTags)},this))},getElements:function(){this.base=
d("#tradein-desktop-side-sheet");this._super()},createReturnAddressPopover:function(){a.recordTv2RefTag(k.refTagReturnAddressUpdateView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#editReturnAddress"),{name:"returnAddressUpdate",dataStrategy:"inline",inlineContent:d("#returnAddressPopoverTemplate").html(),width:400,position:"triggerTop",activate:"onclick"}).show();d(".a-popover").addClass("popover-content-overlay");var b=d(".a-popover.a-declarative.a-arrow-top:visible .tradein-popover-address-container");
this.createReturnAddressInstance(b)},createPromotionInformationPanel:function(){a.recordTv2RefTag(k.refTagPromotionInformationPopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#promotionInformationPopover"),{name:"promotionInformationPopover",dataStrategy:"inline",inlineContent:d("#promotionInformationPopoverTemplate").html(),width:400,position:"triggerBottom",activate:"onclick"}).show();d(".a-popover").addClass("popover-content-overlay")},createNearbyProcessorsPanel:function(){a.recordRefTag(k.refTagNearbyProcessorsDesktop,
n,k.refTagTv2,a.getProductGroup());var b=this.offlineDropOffLocations,c=this.dropOffLocationListTemplate,e=c.find("#dropOffLocationList"),f=this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+this.tradeInReviewData.defaultReturnAddress.postalCode;c.find(".customerAddress").html(f);a.createNearbyProcessorsList(b,e,c);m.create(this.tradeInWrapper.find("#dropOffLocations"),{name:"nearbyProcessorLocationsPopover",dataStrategy:"inline",inlineContent:d("#dropOffLocationListTemplate").html(),
width:400,position:"triggerTop",activate:"onclick"}).show();d(".a-popover").addClass("popover-content-overlay")},createAppraisalLearnMorePanel:function(){a.recordTv2RefTag(k.refTagAppraisalLearnMorePopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);var b=m.create(this.tradeInWrapper.find("#appraisalLearnMore"),{name:"appraisalLearnMorePopover",dataStrategy:"inline",inlineContent:d("#appraisalLearnMorePopoverTemplate").html(),width:400,position:"triggerTop",activate:"onclick"});k.tradeInEchoGl===
this.tradeInProductGroup&&d("#appraisalLearnMorePopoverTemplate").find(".echo-learn-more-link").removeClass("aok-hidden");b.show();d(".a-popover").addClass("popover-content-overlay")},createRegisteredDevicesLearnMorePanel:function(){a.recordTv2RefTag(k.refTagRegisteredDevicesLearnMorePopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#registeredDevicesLearnMore"),{name:"registeredDevicesLearnMorePopover",dataStrategy:"inline",inlineContent:d("#registeredDevicesLearnMorePopoverTemplate").html(),
width:400,position:"triggerBottom",activate:"onclick"}).show();d(".a-popover").addClass("popover-content-overlay")},createAsinDetailsView:function(a){a=d(a.currentTarget);var b=a.data("asinDetailsData");if(b){var c=h.bindDataToAsinSelectionTemplate(this.asinDetailsViewTemplate,b);if(b.hasOwnProperty("isEnabled")&&!b.isEnabled){var b=c.find(".tiv-estimate-container"),e=b.find(".unavailable-offer");d(e).removeClass("aok-hidden");d(b).html(e)}var c={name:"asinDetailsView",inlineContent:c,width:500,position:"triggerHorizontal",
activate:"onclick"},f=m.create(this.tradeInWrapper.find(a),c);f.show();d(".a-popover").addClass("popover-content-overlay");l.on("a:popover:afterShow",function(){d(".a-scroller").addClass("scroll-disabled")});l.on("a:popover:afterHide",function(){d(".a-scroller").removeClass("scroll-disabled")});l.on("tanooki-trade-in-desktop-side-sheet-close",function(){f.hide()})}},createVerticalCardViewComponentWithTradeInTotalContent:function(b,c,e){try{var f=this.getSanitizedItemListFromReviewData();if(this.searchTradeInImageIndicator&&
0<f.length){var g={imageUrl:this.searchTradeInImageIndicator,maxTiv:c};g[b]="classType";var k=h.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,g),l=k.find("#tradeinTotalWithOfferDetailsComponent");f[0].instantPayable?(l.find(".ip").html(a.formatCurrency(c)),l.find(".instant-payable").removeClass("aok-hidden")):(l.find(".not-instant-payable").html(a.formatCurrency(c)),l.find(".not-instant-payable").removeClass("aok-hidden"))}else a.recordError("Required data for vertical card view unavailable",
"Error encountered hitting search refinement request");var m=k.find("#tradeinEstimateOfferComponent .selection-history-list"),p=this.categoryRefinementSelectionItemComponent;0<this.config.translatedSelectionHistory.length?(this.translatedSelectionHistory=this.config.translatedSelectionHistory,this.config.translatedSelectionHistory.forEach(function(a){a=h.bindDataToAsinSelectionTemplate(p,{selectionItem:a});d(m).append(a)})):0<this.config.restrictionHistory.length?(this.restrictionHistory=this.config.restrictionHistory,
this.config.restrictionHistory.forEach(function(a){a=h.bindDataToAsinSelectionTemplate(p,{selectionItem:a.emittedData});d(m).append(a)})):k.find(".vertical-card-tradein-details").addClass("aok-hidden");var q=f.some(function(a){if(a.asin===e)return a.instantPayable});this.config.finalSearchResult&&k.find("#itemTitle").html(a.generatePrettyTitle(this.config.finalSearchResult.asinTitle));a.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&d.each(this.pastPurchasedEligibleItems,function(b,r){e===
r.asin&&k.find("#itemTitle").html(a.generatePrettyTitle(r.title))});if(q){var n=k.find("#ipOfferAmount");d(n).removeClass("aok-hidden");var t=this.tradeInReviewData.orderTotalPaidInstantly,u=d(n).find(".price").first();d(u).html(a.formatCurrency(t))}else{n=k.find("#nonIpOfferAmount");d(n).removeClass("aok-hidden");var v=this.tradeInReviewData.orderTotalPaidOnGrading,y=d(n).find(".price").first();d(y).html(a.formatCurrency(v))}}catch(A){throw"[Error at createVerticalCardViewComponentWithTradeInTotalContent]"+
A;}return k}})});"use strict";u.when("A","trade-in-wireless-asin-category-selection-controller","ready").register("trade-in-asin-category-selection-controller-factory",function(l,m){return{ctrlInstance:null,getInstance:function(){this.ctrlInstance||(this.ctrlInstance=new m);return this.ctrlInstance}}});"use strict";u.when("A","a-popover","a-button","trade-in-constants","trade-in-common-base","trade-in-common-utils","trade-in-data-binder","tradein-show-promotion-expander","trade-in-cc-constants","trade-in-cc-expander",
"trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile","search-refinement-title-migration","ready").register("trade-in-asin-category-selection-base-controller",function(l,m,k,a,h,e,g,c,b,d,p,q,n){var f=l.$;return h.extend({config:null,deviceType:null,authPortalAssocHandle:null,navViews:null,navCurrentView:null,tradeInWrapper:null,loadingSpinner:null,tradeInViewInstanceName:null,tradeInSaveGradedItemConditionUrl:null,tradeInReviewUrl:null,tradeInSubmitUrl:null,tradeInRefTagUrl:null,
tradeInRemoveItemUrl:null,tradeInRefTagPrefix:null,bifurcationRefTags:[],tradeInProductGroup:null,restrictionSelectionPage:[],priceHistory:[],showVerticalImageCardView:!1,searchTradeInImageIndicator:null,finalSearchResults:null,changeConditionData:null,conditionSelectionMap:null,isChangeConditionContext:!1,estimatedMaxTiv:0,expectedPages:0,hasPendingRequest:!1,tradeInReviewData:null,promotionEligible:!1,selectionInProgress:!1,isProcessing:!1,invalidReturnAddress:!1,legalCheckBoxesChecked:!1,checkBoxesChecked:!1,
isStorefront:!1,isLowestAppraisal:!1,tradeInSearchCurrentState:{term:""},searchPageSize:0,searchOffersOnly:!0,pastPurchasedEligibleItems:[],questionnaires:[],restrictionHistory:[],translatedSelectionHistory:[],previousView:null,currentAsin:[],promoData:null,showOfflineOption:!1,offlineDropOffLocations:[],tradeInCartQuantity:0,tradeInCartTiv:0,conditionViewTemplate:null,tradeinHeaderViewTemplate:null,tradeInPromoPreviewViewTemplate:null,tradeinCartHeaderTemplate:null,tradeinCartSubmitViewHeaderTemplate:null,
verticalComplexCardViewTemplate:null,appraisalSelectionComponentView:null,termsAndAgreementViewTemplate:null,multiItemTermsAndAgreementViewTemplate:null,multiItemTermsAndAgreementViewTemplateDevices:null,tradeinReviewYourOrderNextStepTemplate:null,mixedOfferNextStepsTemplate:null,multiItemConfirmationOrderDetailsViewComponent:null,tradeinFooterComponent:null,successfulTradeInBannerComponentView:null,tradeInSubmitConditionButtonTemplate:null,binaryQuestionnaireListViewTemplate:null,shipmentDetailViewComponent:null,
dropOffLocationsTemplate:null,dropOffBannerNoLinkComponent:null,dropOffLocationListTemplate:null,offlineMessageSection:null,searchRefinementItemSelectionTemplate:null,refinementSearchViewTemplate:null,categoryRefinementSelectionItemComponent:null,tradeinCartItemComponent:null,shipmentDetailsHeaderComponent:null,tradeinSubmitButtonComponent:null,tradeinSubmitWrapperComponent:null,tradeinCartTemplate:null,customerPastDevicesPurchasesCarouselContainerTemplate:null,pastPurchasedListViewTemplate:null,
customerIpPreferenceComponent:null,customerIpPreference:null,pastPurchaseSelected:!1,load:function(){this.config=l.state("tradeInConfig");this.pastPurchasedEligibleItems=this.config.eligibleItems;this.questionnaires=this.config.questionnaires;e.setLocale(this.config.locale);e.setCurrencyCode(this.config.currencyCode);g.setCommonUtils(e);this.navViews={refinementSelectionView:a.refinementSelectionViewWrapperClass,refinementSearchView:a.refinementSearchViewClass,tradeInConditionView:a.conditionViewTemplateId,
submitTradeInView:a.submitTradeInWrapperClass,tradeInCartView:a.tradeInCartViewClass,restrictionSearchTradeInNextStepView:a.tradeinReviewYourOrderNextStepTemplateId};this.init();this.getElements();this.bindEvents();this.cleanState();this.navCurrentView=this.navViews.refinementSelectionView;this.updateCartHeaderData();this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},setConstants:function(b,c,d){this.tradeInRefTagPrefix=a.refTagTv2;this.tradeInViewInstanceName=b;this.tradeInProductGroup=
c;this.tradeInSubmitUrl=a.tradeInRouteBase+"confirmTradeInOrder?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"submit_request_"+c;this.tradeInSaveGradedItemConditionUrl=a.tradeInRouteBase+"addToTradeIn";this.tradeInRefTagUrl=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+this.deviceType+"\x26ref_\x3d";this.tradeInReviewUrl=a.tradeInRouteBase+"reviewTradeInOrder?deviceType\x3d"+this.deviceType+"\x26productGroup\x3d"+c+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"review_request_"+
c;this.tradeInSearchCategoryRefinementUrl=a.tradeInRouteBase+"searchRestrictionItems?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"\x26productGroup\x3d"+c;this.tradeInGetSelfGradingQuestionnaireUrl=a.tradeInRouteBase+"getSelfGradingQuestionnaire?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"\x26productGroup\x3d"+c;this.tradeInRemoveItemUrl=a.tradeInRouteBase+"removeItem?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"remove_item_request_"+
c;this.isStorefront=d;this.searchPageSize=e.getTanookiV2SearchPageSize(this.deviceType)},getElements:function(){this.tradeInWrapper=this.base.find(a.tradeInWrapperClass);this.conditionViewTemplate=this.base.find(a.conditionViewTemplateId);this.tradeinHeaderViewTemplate=this.base.find(a.tradeinHeaderViewTemplateId);this.tradeinCartHeaderTemplate=this.base.find(a.tradeinCartHeaderTemplateId);this.tradeinCartSubmitViewHeaderTemplate=this.base.find(a.tradeinCartSubmitViewHeaderTemplateId);this.tradeInCartPromosTemplate=
this.base.find(a.tradeInCartPromosTemplateId);this.tradeInPromoPreviewViewTemplate=this.base.find(a.tradeInPromoPreviewViewTemplate);this.verticalComplexCardViewTemplate=this.base.find(a.verticalComplexCardViewTemplateId);this.appraisalSelectionComponentView=this.base.find(a.appraisalSelectionComponentViewId);this.promotionInformationComponent=this.base.find(a.promotionInformationComponentId);this.termsAndAgreementViewTemplate=this.base.find(a.termsAndAgreementViewTemplateId);this.multiItemTermsAndAgreementViewTemplate=
this.base.find(a.multiItemTermsAndAgreementViewTemplateId);this.multiItemTermsAndAgreementViewTemplateDevices=this.base.find(a.multiItemTermsAndAgreementViewTemplateDevicesId);this.tradeinReviewYourOrderNextStepTemplate=this.base.find(a.tradeinReviewYourOrderNextStepTemplateId);this.mixedOfferNextStepsTemplate=this.base.find(a.mixedOfferNextStepsTemplateId);this.multiItemConfirmationOrderDetailsViewComponent=this.base.find(a.multiItemConfirmationOrderDetailsViewComponentClass);this.tradeinFooterComponent=
this.base.find(a.tradeinFooterComponentId);this.successfulTradeInBannerComponentView=this.base.find(a.successfulTradeInBannerComponentViewId);this.tradeInSubmitConditionButtonTemplate=this.base.find(a.tradeInSubmitConditionButtonTemplateId);this.binaryQuestionnaireListViewTemplate=this.base.find(a.binaryQuestionnaireListViewTemplateId);this.shipmentDetailViewComponent=this.base.find(a.shipmentDetailViewComponentId);this.dropOffLocationsTemplate=this.base.find(a.dropOffLocationsTemplateId);this.dropOffBannerNoLinkComponent=
this.base.find(a.dropOffBannerNoLinkComponentId);this.dropOffLocationListTemplate=this.base.find(a.dropOffLocationListTemplateId);this.offlineMessageSection=this.base.find(a.offlineMessageSectionClass);this.searchRefinementItemSelectionTemplate=this.base.find(a.searchRefinementItemSelectionTemplateId);this.refinementSearchViewTemplate=this.base.find(a.refinementSearchViewTemplateId);this.categoryRefinementSelectionItemComponent=this.base.find(a.categoryRefinementSelectionItemComponentId);this.tradeinCartItemComponent=
this.base.find(a.tradeinCartItemComponentId);this.shipmentDetailsHeaderComponent=this.base.find(a.shipmentDetailsHeaderComponentClass);this.tradeinSubmitButtonComponent=this.base.find(a.tradeinSubmitButtonComponentClass);this.tradeinSubmitWrapperComponent=this.base.find(a.tradeinSubmitWrapperComponentId);this.tradeInCartTemplate=this.base.find(a.tradeInCartTemplateId);this.customerPastDevicesPurchasesCarouselContainerTemplate=this.base.find(a.customerPastDevicesPurchasesCarouselContainerId);this.pastPurchasedListViewTemplate=
this.base.find(a.pastPurchasedListViewTemplateId);this.asinDetailsViewTemplate=this.base.find(a.asinDetailsViewTemplateId);this.customerIpPreferenceComponent=this.base.find(a.customerIpPreferenceComponentId);this.loadingSpinner=this.base.find(a.loadingSideSheetSpinnerClass);this.base.find(a.tradeInMoreItemsButtonContainerClass).removeClass("aok-hidden")},bindEvents:function(){this.tradeInWrapper.delegate(".previous-button","click",f.proxy(this.handlePreviousButton,this));this.tradeInWrapper.delegate(".navigate-to-cart-button",
"click",f.proxy(this.handleNavigateToCart,this));this.tradeInWrapper.delegate(".print-shipping-label-container #printLabelButton","click",f.proxy(this.handlePrintShippingLabel,this));this.tradeInWrapper.delegate(".error-alert-continue-button","click",f.proxy(this.handleNavigateToCart,this));this.tradeInWrapper.delegate(".non-tradeable-error-alert-continue-button","click",f.proxy(this.handleTradeInMoreItems,this));this.tradeInWrapper.delegate("#editReturnAddress","click",f.proxy(this.createReturnAddressPopover,
this));this.tradeInWrapper.delegate("#promotionInformationPopover","click",f.proxy(this.createPromotionInformationPanel,this));this.tradeInWrapper.delegate("#appraisalLearnMore","click",f.proxy(this.createAppraisalLearnMorePanel,this));this.tradeInWrapper.delegate("#registeredDevicesLearnMore","click",f.proxy(this.createRegisteredDevicesLearnMorePanel,this));this.tradeInWrapper.delegate("#dropOffLocations","click",f.proxy(this.createNearbyProcessorsPanel,this));this.tradeInWrapper.delegate(".adjusted-value-agreement-button",
"click",f.proxy(this.handleAdjustedValueAgreementButton,this));this.tradeInWrapper.delegate(".ip-preference-button","click",f.proxy(this.handleIpPreferenceButton,this));this.tradeInWrapper.delegate(".handle-submit-your-tradein","click",f.proxy(function(a){var b=f(a.currentTarget);k(a).isEnabled()&&!b.hasClass("a-button-disabled")&&this.handleTradeInSubmit()},this));this.tradeInWrapper.delegate(".handle-review-your-tradein","click",f.proxy(function(a){var b=f(a.currentTarget);k(a).isEnabled()&&!b.hasClass("a-button-disabled")&&
this.handleNavigateToCart()},this));this.tradeInWrapper.delegate(".handle-trade-in-more-items","click",f.proxy(function(a){this.handleTradeInMoreItems()},this));this.tradeInWrapper.delegate(".agreement-checkbox","change",f.proxy(function(a){this.handleTermsAndAgreementCheckboxSelection(a,".agreement-checkbox")},this));this.tradeInWrapper.delegate(".agreement-checkbox-multi-item","change",f.proxy(function(a){this.handleTermsAndAgreementCheckboxSelection(a,".agreement-checkbox-multi-item")},this));
this.tradeInWrapper.delegate(".continue-trigger","click",f.proxy(function(a){k(a).isEnabled()&&(this.isChangeConditionContext?this.handleChangeConditionComplete():this.handleContinueConditionButtonClick())},this));this.tradeInWrapper.delegate(a.conditionQuestionButtonSelectorClass,"click",f.proxy(function(a){var b=f(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handleConditionSelection(a)},this));this.tradeInWrapper.delegate(".submit-refinement button","click",f.proxy(function(a){var b=
f(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handleRefinementSubmit(a)},this));this.tradeInWrapper.delegate(".past-purchase-refinement","click",f.proxy(function(a){var b=f(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handlePastPurchaseRefinementSelect(a)},this));this.tradeInWrapper.delegate(".refinement-search-form","submit",f.proxy(function(a){this.handleRefinementSearchFormSubmit(a)},this));this.tradeInWrapper.delegate("#loadMoreSearchResults",
"click",f.proxy(function(a){f(a.currentTarget).blur();this.handleLoadMoreSearchResults()},this));this.tradeInWrapper.delegate("#seeAllSearchResults","click",f.proxy(function(){this.searchOffersOnly=!1;this.handleRefinementSearchFormSubmit()},this));this.tradeInWrapper.delegate("#seeOnlyOffersSearchResults","click",f.proxy(function(){this.searchOffersOnly=!0;this.handleRefinementSearchFormSubmit()},this));this.tradeInWrapper.delegate(a.refinementSearchInputSelector,"focusin",f.proxy(function(){this.tradeInWrapper.find(".refinement-search-button").addClass("active")},
this));this.tradeInWrapper.delegate(a.refinementSearchInputSelector,"focusout",f.proxy(function(){this.tradeInWrapper.find(".refinement-search-button").removeClass("active")},this));this.tradeInWrapper.delegate(".refinement-search-item-title","click",f.proxy(function(a){this.createAsinDetailsView(a)},this));this.tradeInWrapper.delegate(".tradein-cart-item a.remove-link","click",f.proxy(function(b){e.recordTv2RefTag(a.refTagRemoveCartItem,this.tradeInRefTagUrl,this.bifurcationRefTags);this.handleRemoveCartItem(b)},
this));this.tradeInWrapper.delegate(".tradein-cart-item a.change-condition-link","click",f.proxy(function(b){e.recordTv2RefTag(a.refTagChangeCondition,this.tradeInRefTagUrl,this.bifurcationRefTags);this.handleNavigateToChangeCondition(b)},this));this.tradeInWrapper.delegate("a.tradein-login","click",f.proxy(function(){var a=e.getAuthPortalHandleFromHostname();e.redirectToAuth(a,"launchAsinCategoryTradeIn")},this));this.tradeInWrapper.delegate("#submitTradeInButtonAgreementText","click",f.proxy(function(){e.recordTv2RefTag(a.refTagTermsAndConditions,
this.tradeInRefTagUrl,this.bifurcationRefTags)},this));this.tradeInWrapper.delegate("a#howToLink","click",f.proxy(function(){e.recordTv2RefTag(a.refTagHowToLink+"_"+this.getCurrentRefinementTitleForRefTag(),this.tradeInRefTagUrl,this.bifurcationRefTags)},this))},createView:function(){this.clearAllViews();switch(this.navCurrentView){case this.navViews.refinementSelectionView:this.recordViewRefTag();this.createRestrictionItemView();break;case this.navViews.refinementSearchView:this.recordViewRefTag();
this.createRefinementSearchView();break;case this.navViews.tradeInConditionView:this.isChangeConditionContext?this.createTradeInChangeConditionView():(this.recordViewRefTag(),this.createTradeInConditionView());break;case this.navViews.submitTradeInView:this.recordViewRefTag();this.createSubmitTradeInView();break;case this.navViews.tradeInCartView:this.recordViewRefTag();this.createTradeInCartView();break;case this.navViews.restrictionSearchTradeInNextStepView:this.createTradeInNextStepsView();break;
default:this.createRestrictionItemView()}},createTradeInHeaderComponent:function(a){try{var b=g.bindDataToAsinSelectionTemplate(this.tradeinHeaderViewTemplate,{progressPercentage:Math.ceil(this.config.pageIndex/this.expectedPages*100)+"%"});b.find(".back-button-container").removeClass("aok-hidden");a||b.find(".previous-button").addClass("aok-hidden")}catch(c){e.recordError(c,"Error occurred at createTradeInHeaderComponent")}return b},createTradeInCartHeaderComponent:function(b){try{var c=g.bindDataToAsinSelectionTemplate(b,
{cartQuantity:this.tradeInCartQuantity,cartTiv:this.tradeInCartTiv});this.tradeInCartQuantity&&0!==this.tradeInCartQuantity?(c.removeClass("aok-hidden"),1===this.tradeInCartQuantity?(c.find(a.tradeinCartHeaderItemsSingularClass).removeClass("aok-hidden"),c.find(a.tradeinCartHeaderItemsPluralClass).addClass("aok-hidden")):(c.find(a.tradeinCartHeaderItemsSingularClass).addClass("aok-hidden"),c.find(a.tradeinCartHeaderItemsPluralClass).removeClass("aok-hidden"))):c.addClass("aok-hidden")}catch(d){e.recordError(d,
"Error occurred at createTradeInCartHeaderComponent")}return c},shouldShowPromos:function(){return this.tradeInReviewData.hasOwnProperty("promotionEligible")&&this.tradeInReviewData.promotionEligible&&Array.isArray(this.tradeInReviewData.promotionEligibilityText)&&this.tradeInReviewData.promotionEligibilityText.length?!0:!1},shouldShowPromoHeader:function(){return 0===this.tradeInCartQuantity},createVerticalCardViewComponentWithTradeInEstimateContent:function(){try{if(this.searchTradeInImageIndicator&&
this.estimatedMaxTiv)var a=g.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,{tradeinEstimateDetails:"classType",imageUrl:this.searchTradeInImageIndicator,maxTiv:this.estimatedMaxTiv});else e.recordError("Required data for vertical card view unavailable","Error encountered hitting search refinement request");var b=a.find(".selection-history-list"),c=this.categoryRefinementSelectionItemComponent;if(this.config.finalSearchResult){var d=e.generatePrettyTitle(this.config.finalSearchResult.asinTitle);
a.find("#itemTitle").html(d)}else if(this.finalSearchResults){var h=this.finalSearchResults.asin;this.pastPurchasedEligibleItems&&f.each(this.pastPurchasedEligibleItems,function(b,c){h===c.asin&&a.find("#itemTitle").html(e.generatePrettyTitle(c.title))})}0<this.currentAsin.length&&a.find("#itemTitle").html(e.generatePrettyTitle(this.currentAsin.title));0<this.config.translatedSelectionHistory.length?(this.translatedSelectionHistory=this.config.translatedSelectionHistory,this.config.translatedSelectionHistory.forEach(function(a){a=
g.bindDataToAsinSelectionTemplate(c,{selectionItem:a});f(b).append(a)})):0<this.config.restrictionHistory.length?(this.restrictionHistory=this.config.restrictionHistory,this.config.restrictionHistory.forEach(function(a){a=g.bindDataToAsinSelectionTemplate(c,{selectionItem:a.emittedData});f(b).append(a)})):a.find(".vertical-card-tradein-details").addClass("aok-hidden")}catch(k){throw"[Error at createVerticalCardViewComponentWithTradeInEstimateContent]"+k;}return a},createPastDevicePurchasesContainerViewComponent:function(){var b=
this.pastPurchasedEligibleItems,c=g.bindDataToTemplate(this.customerPastDevicesPurchasesCarouselContainerTemplate,{instantPayable:this.config.hasOwnProperty("instantPayable")?this.config.instantPayable:!1});c.find(a.eligibleItemsCountId).append(b.length);var d=c.find(a.eligibleItemListWrapper);this.createPastPurchasesForTradeInCardTemplates(b,this.pastPurchasedListViewTemplate,d);this.tradeInWrapper.append(c);return c},createPastPurchasesForTradeInCardTemplates:function(b,c,d){f.each(b,f.proxy(function(b,
r){b=g.bindDataToTemplate(c,r);var f=e.formatCurrency(r.conditionOfferMap.NonFunctional.tiv),h=r.tradeInItemType===a.tradeInItemTypeEcho?e.formatCurrency(r.conditionOfferMap.Working.tiv):e.formatCurrency(r.conditionOfferMap.Good.tiv);if(r.deviceTitle){var k=this.truncateString(r.deviceTitle,18);b.find(".item-device-title").removeClass("aok-hidden");b.find(".item-device-title").html(k);k=this.truncateString(e.generatePrettyTitle(r.title),15)}else k=this.truncateString(e.generatePrettyTitle(r.title),
28);b.find(".item-title").html(k);""!==r.dateRegisteredString&&(b.find(".registered-date-wrapper").removeClass("aok-hidden"),b.find(a.dateRegisteredClass).html(r.dateRegisteredString));f!==h?(b.find(".tiv-estimate-container .min-tiv").html(f+" -"),b.find(".tiv-estimate-container .max-tiv").html(h)):b.find(".tiv-estimate-container .max-tiv").html(f);d.append(b)},this))},truncateString:function(a,b){return a.length>b?a.substr(0,b-1)+"\x26hellip;":a},createShipmentDetailComponent:function(){try{var a=
g.bindDataToAsinSelectionTemplate(this.shipmentDetailViewComponent);a.find(".shipByDate").html(this.tradeInReviewData.shipByDateString);a.find(".customerEmail").html(this.tradeInReviewData.emailAddress);if(this.tradeInReviewData.hasOwnProperty("defaultReturnAddress")){var b=this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+this.tradeInReviewData.defaultReturnAddress.postalCode;a.find(".customerAddress").html(b)}}catch(c){throw"[Error at createShipmentDetailComponent]"+
c;}return a},createSubmitButtonComponent:function(){var b=this.tradeinSubmitWrapperComponent.clone();b.removeClass("aok-hidden");e.isGlEligibleForPastPurchases(this.tradeInProductGroup)?(k(f(b.find(a.submitButtonViewClass))).enable(),k(f(b.find(a.tradeInMoreItemsButtonViewClass))).enable()):(k(f(b.find(a.submitButtonViewClass))).disable(),k(f(b.find(a.reviewButtonViewClass))).disable(),k(f(b.find(a.tradeInMoreItemsButtonViewClass))).disable());this.tradeInProductGroup===a.tradeInEchoGl&&(this.checkBoxesChecked=
!0);this.tradeInReviewData.hasOwnProperty("freeShipping")&&this.tradeInReviewData.freeShipping&&this.checkBoxesChecked?k(f(b.find(a.submitButtonViewClass))).enable():k(f(b.find(a.submitButtonViewClass))).disable();return b},areAllItemsAcceptWorseReturnType:function(a){if(!a)return!0;for(var b=0;b<a.length;b++){var c=a[b].selectedReturnType;if(!c||"ACCEPT_WORSE"!==c)return!1}return!0},createTermsAndAgreementComponent:function(b){try{var c=g.bindDataToAsinSelectionTemplate(b);k(f(c.find(".a"))).disable();
e.isGlEligibleForPastPurchases(this.tradeInProductGroup)?(k(f(c.find(a.submitButtonViewClass))).enable(),k(f(c.find(a.tradeInMoreItemsButtonViewClass))).enable()):(k(f(c.find(a.submitButtonViewClass))).disable(),k(f(c.find(a.reviewButtonViewClass))).disable(),k(f(c.find(a.tradeInMoreItemsButtonViewClass))).disable());this.areAllItemsAcceptWorseReturnType(this.tradeInReviewData.sanitizedItemsList)?(f(c).find(".terms-and-conditions-return-worse").addClass("aok-hidden"),f(c).find(".terms-and-conditions-accept-worse").removeClass("aok-hidden")):
(f(c).find(".terms-and-conditions-return-worse").removeClass("aok-hidden"),f(c).find(".terms-and-conditions-accept-worse").addClass("aok-hidden"));var d=!1;this.config.restrictionHistory.length?this.config.restrictionHistory.forEach(function(a,b){"manufacturer"===a.key&&"Apple"===a.emittedData&&(d=!0)}):this.pastPurchaseSelected?e.recordMetric(a.tanookiV2PastPurchaseSelectedMetric):e.recordError("Missing Restriction History\n"+JSON.stringify(this.config),"Error occured when access restriction history");
d&&c.find(".alert-box").append(f(".tradein-templates .tradein-info-apple-device").clone())}catch(h){throw"[Error at createTermsAndAgreementComponent]"+h;}return c},createSubmitTradeinInformation:function(){try{var a=f(".tradein-templates #submitTradeInInformationTemplate #submitTradeInInstructionText").clone()}catch(b){throw"[Error at createSubmitTradeinInformation]"+b;}return a},createAdjustedValueQuestionComponent:function(b){try{var c=e.findMinMaxTivInContainer(b),d=g.bindDataToAsinSelectionTemplate(this.appraisalSelectionComponentView,
{minTiv:c[0],maxTiv:c[1]});d.find(a.appraisalTivHeaderClass).removeClass("aok-hidden");d.addClass("aok-hidden")}catch(f){throw"[Error at createAdjustedValueQuestionComponent]"+f;}return d},createIPPreferenceComponent:function(){try{var a=g.bindDataToAsinSelectionTemplate(this.customerIpPreferenceComponent)}catch(b){throw"[Error at createIPPreferenceComponent]"+b;}return a},createFooterComponent:function(){try{var a=g.bindDataToAsinSelectionTemplate(this.tradeinFooterComponent)}catch(b){throw"[Error at createFooterComponent]"+
b;}return a},createConditionQuestionComponent:function(b){try{for(var c=g.bindDataToAsinSelectionTemplate(this.conditionViewTemplate),d=0;d<b.length;d++){var e=b[d],h=g.bindDataToAsinSelectionTemplate(this.binaryQuestionnaireListViewTemplate,e);if(e.hasOwnProperty("choices"))for(var k=f(h.find(".radio-button-list")),l=0;l<e.choices.length;l++)if(e.choices[l]){var m=e.choices[l],p;if(0===l)p=f(k).find("#binaryAnswerOne");else if(1===l)p=f(k).find("#binaryAnswerTwo");else continue;p.attr("name",e.id);
p.attr("value",m.condition);f(p).find(".a-button-inner .a-button-text").html(m.descriptionText)}c.find(a.conditionQuestionnaireListClass).append(h)}}catch(n){throw"[Error at createConditionQuestionComponent]"+n;}return c},createSubmitTradeInView:function(){try{var b=1<this.tradeInCartQuantity,d=[],g=this.finalSearchResults.asin,h;if(this.tradeInReviewData.hasOwnProperty("qtyLimitExceedItems"))e.isMobileVariant(this.deviceType)||this.tradeInWrapper.append(f(a.tradeInErrorExitButtonSelector).clone()).addClass("active"),
this.tradeInWrapper.append(f(a.tradeInQuantityExceededErrorSelector).clone()).addClass("active");else if(this.tradeInReviewData.hasOwnProperty("nonTradeableItems"))e.isMobileVariant(this.deviceType)||this.tradeInWrapper.append(f(a.tradeInErrorExitButtonSelector).clone()).addClass("active"),this.tradeInWrapper.append(f(a.tradeInNonTradeableErrorSelector).clone()).addClass("active");else{if(this.tradeInReviewData.hasOwnProperty("hazmatErrors")){var k=this.tradeInReviewData.hazmatErrors,l=!1;k.forEach(function(a){a.asin===
g&&(l=!0)});if(l){e.isMobileVariant(this.deviceType)||this.tradeInWrapper.append(f(a.tradeInErrorExitButtonSelector).clone()).addClass("active");this.tradeInWrapper.append(f(a.tradeInMixHazmatErrorSelector).clone()).addClass("active");return}h=f(a.tradeInMixHazmatCartItemErrorSelector).clone();var m=h.find(a.tradeInHazmatItemList);k.forEach(function(b){var c=h.find(a.tradeInHazmatListItemTemplate).clone();c.html(b.title).removeClass("aok-hidden");m.append(c)});e.recordTv2RefTag(a.refTagHazmatError,
this.tradeInRefTagUrl,this.bifurcationRefTags)}this.promotionEligible=this.tradeInReviewData.hasOwnProperty("promotionEligible")?this.tradeInReviewData.promotionEligible:!1;d.push(this.createTradeInHeaderComponent(!0));if(this.shouldShowPromos()){this.promoData=this.tradeInReviewData.promotionEligibilityText;this.tradeInReviewData.hasOwnProperty("promotionMessages")&&this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var p;p=c.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,
this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);d.push(p)}d.push(this.createTradeInCartHeaderComponent(this.tradeinCartSubmitViewHeaderTemplate));var n=0;this.getSanitizedItemListFromReviewData().forEach(function(a){a.asin===g&&(n=a.tradeInValue)});if(b)d.push(this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinTotalOfferDetails",n,g)),h&&d.push(h.addClass("active")),e.isGlEligibleForPastPurchases(this.tradeInProductGroup)?d.push(this.createTermsAndAgreementComponent(this.multiItemTermsAndAgreementViewTemplateDevices)):
d.push(this.createTermsAndAgreementComponent(this.multiItemTermsAndAgreementViewTemplate));else{this.validateReturnAddress(d);d.push(this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinTotalOfferDetails",n,g));h&&d.push(h.addClass("active"));e.isWirelessVgProductGroup(this.tradeInProductGroup)&&d.push(this.createSubmitTradeinInformation());var q=this.createTermsAndAgreementComponent(this.termsAndAgreementViewTemplate);q.find(a.tradeinSubmitButtonComponentClass).addClass("aok-hidden");
q.find(a.tradeInMoreItemsButtonContainerClass).addClass("aok-hidden");d.push(q);d.push(this.shipmentDetailsHeaderComponent);d.push(this.createShipmentDetailComponent());this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,d.push(this.dropOffBannerNoLinkComponent));var t=this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace;this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")&&
this.tradeInReviewData.instantPaymentEligible&&t&&e.isCETechGl(this.tradeInProductGroup)&&d.push(this.createIPPreferenceComponent());d.push(this.createSubmitButtonComponent())}d.push(this.createFooterComponent());this.renderTemplateView(d)}}catch(u){e.recordError(u,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},createTradeInConditionView:function(){try{var a=[],b=this.createTradeInHeaderComponent(!0);
a.push(b);b=[];this.config.hasOwnProperty("selectionDetails")&&(b=this.config.selectionDetails.translatedPromoStrings||[]);this.finalSearchResults.translatedPromoStrings&&0===b.length&&(b=this.finalSearchResults.translatedPromoStrings);if(this.shouldShowPromoHeader()){var c=this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,b);a.push(c)}var d=this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate);a.push(d);var h=this.createVerticalCardViewComponentWithTradeInEstimateContent();
a.push(h);var l=this.createConditionQuestionComponent(this.finalSearchResults.gradingQuestion);a.push(l);this.conditionSelectionMap={tradeInQuestions:this.finalSearchResults.gradingQuestion,conditionOfferMap:this.finalSearchResults.conditionOfferMap,gradedCondition:null,tradeInValue:null,tradeInQuestionResponses:{}};var m=this.createAdjustedValueQuestionComponent(this.finalSearchResults.conditionOfferMap);a.push(m);var p=g.bindDataToAsinSelectionTemplate(this.tradeInSubmitConditionButtonTemplate);
k(f(p.find(".continue-trigger"))).disable();a.push(p);var n=this.createFooterComponent();a.push(n);this.renderTemplateView(a)}catch(q){e.recordError(q,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}this.showVerticalImageCardView=!1},createTradeInChangeConditionView:function(){try{var a=this.changeConditionData,b=[];b.push(this.createTradeInHeaderComponent(!0));b.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));
var c=g.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,{tradeinEstimateDetails:"classType",imageUrl:a.verticalImageUrl,maxTiv:a.maxTiv});b.push(c);var d=c.find(".selection-history-list"),h=this.categoryRefinementSelectionItemComponent;0<this.translatedSelectionHistory.length?this.translatedSelectionHistory.forEach(function(a){a=g.bindDataToAsinSelectionTemplate(h,{selectionItem:a});f(d).append(a)}):this.verticalComplexCardViewTemplate.find(".vertical-card-tradein-details").addClass("aok-hidden");
b.push(this.createConditionQuestionComponent(a.gradingQuestion));this.conditionSelectionMap={tradeInQuestions:a.gradingQuestion,conditionOfferMap:a.conditionOfferMap,gradedCondition:null,tradeInValue:null,tradeInQuestionResponses:{}};b.push(this.createAdjustedValueQuestionComponent(a.conditionOfferMap));var l=g.bindDataToAsinSelectionTemplate(this.tradeInSubmitConditionButtonTemplate);k(f(l.find(".continue-trigger"))).disable();b.push(l);b.push(this.createFooterComponent());this.renderTemplateView(b)}catch(m){e.recordError(m,
"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},generatePromoHeader:function(a,b){if(b&&0<b.length){a.removeClass("aok-hidden");var c=f("\x3cdiv/\x3e"),d=f("#promoMessageContentTemplate");b.forEach(function(a){var b={displayTitle:a};a.hasOwnProperty("subtitle")&&(b={displayTitle:a.title,subtitle:a.subtitle});a=g.bindDataToAsinSelectionTemplate(d,b);c.append(a)});var e=a.clone();1<b.length?(e.find("#finalPromotionCount").html(b.length.toString()),
e.find(".tradein-promo-expander-view").removeClass("aok-hidden"),e.find(".tradein-promo-expander-row-container").html(c.html())):(e.find(".tradein-cart-promo-view").removeClass("aok-hidden"),e.find(".tradein-cart-promo-view").html(c.html()))}return e},generatePromoHeaderNoExpander:function(a,b){var c="";if(b&&0<b.length){var d=g.bindDataToAsinSelectionTemplate(a);d.removeClass("aok-hidden");c=d.clone();c.empty();b.forEach(function(a){var b={displayTitle:a};a.hasOwnProperty("subtitle")&&(b={displayTitle:a.title,
subtitle:a.subtitle});a=g.bindDataToAsinSelectionTemplate(d,b);c.append(a)})}return c},createTradeInNextStepsView:function(){try{var b=[];b.push(this.createTradeInHeaderComponent(!1));b.push(g.bindDataToAsinSelectionTemplate(this.successfulTradeInBannerComponentView));var d,h=this.tradeInSubmitData.ipItems+this.tradeInSubmitData.nonIpItems,k=this.getIsMixedOfferFromSubmitData(),l=this.getIsIpOnlyOfferFromSubmitData(),m=this.customerIpPreference===a.instantPaymentNow&&l;1<h?b.push(this.createMultiItemConfirmationView()):
b.push(this.createSingleItemConfirmationView());d=k?this.mixedOfferNextStepsTemplate.clone():g.bindDataToAsinSelectionTemplate(this.tradeinReviewYourOrderNextStepTemplate,{instantPaymentEligible:m});if(this.shouldShowPromos()){this.promoData=this.tradeInReviewData.promotionEligibilityText;this.tradeInReviewData.hasOwnProperty("promotionMessages")&&this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var p;p=c.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,
this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);b.push(p)}d.find(".shipByDate").html(this.tradeInSubmitData.shipByDate);d.find(".customerEmail").html(this.tradeInSubmitData.customerEmailAddress);this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,d.find(".next-steps-list").append(this.dropOffLocationsTemplate));b.push(d);this.renderTemplateView(b)}catch(n){e.recordError(n,
"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},createMultiItemConfirmationView:function(){var a=this.tradeInSubmitData.ipItems,b=this.tradeInSubmitData.nonIpItems,c=a+b,d=this.getIsMixedOfferFromSubmitData(),e=this.getIsIpOnlyOfferFromSubmitData(),e=g.bindDataToAsinSelectionTemplate(this.multiItemConfirmationOrderDetailsViewComponent,{mixedOffer:d,ipOnlyOffer:e,maxTiv:this.tradeInSubmitData.totalAmount,
ipTiv:this.tradeInSubmitData.ipAmount,nipTiv:this.tradeInSubmitData.nonIPAmount});d?(e.find(".confirmedIpItemCount").html(a),e.find(".confirmedNipItemCount").html(b)):e.find(".confirmedItemCount").html(c);return e},createSingleItemConfirmationView:function(){this.searchTradeInImageIndicator||(this.searchTradeInImageIndicator=this.getSanitizedItemListFromReviewData()[0].imageUrl);var a=this.finalSearchResults?this.finalSearchResults.asin:this.getSanitizedItemListFromReviewData()[0].asin;return this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinConfirmationOrderDetails",
this.tradeInSubmitData.totalAmount,a)},createRestrictionItemView:function(){try{var b=this.config,c=b.selectionDetails,d=[];b.hasOwnProperty("expectedPages")?this.expectedPages=b.expectedPages+2:e.recordError("expectedPages property missing from config","tradeinConfig.expectedPages");d.push(this.createTradeInHeaderComponent(1!==b.pageIndex));d.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));1===this.config.pageIndex&&e.isGlEligibleForPromotions(this.tradeInProductGroup)&&
d.push(this.promotionInformationComponent);1===b.pageIndex&&e.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&0<this.pastPurchasedEligibleItems.length&&d.push(this.createPastDevicePurchasesContainerViewComponent());this.shouldShowPromoHeader()&&d.push(this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,c.translatedPromoStrings||[]));this.showVerticalImageCardView&&(d.push(this.createVerticalCardViewComponentWithTradeInEstimateContent()),this.showVerticalImageCardView=!1);var h=g.bindCategoryRefinementDataToTemplate(this.searchRefinementItemSelectionTemplate,
c,this.deviceType);h.find(a.howToLinkHelperTitleId).text(c.refinementTitle);(this.tradeInProductGroup===a.tradeInEchoGl||e.isVGProductGroup(this.tradeInProductGroup)&&0===this.config.restrictionHistory.length)&&h.find("#howToHelper").addClass("aok-hidden");this.populateUnavailableOffers(h);d.push(h);d.push(this.createFooterComponent());this.renderTemplateView(d,f.proxy(function(){g.normalizeGridRowHeights(h)}))}catch(k){e.recordError(k,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},
createRefinementSearchView:function(){var b=this.config,c=b.selectionDetails,d=[],h=this.tradeInSearchCurrentState.term&&0<this.tradeInSearchCurrentState.term.length;b.hasOwnProperty("expectedPages")?this.expectedPages=b.expectedPages+2:e.recordError("expectedPages property missing from config","tradeinConfig.expectedPages");d.push(this.createTradeInHeaderComponent(1!==b.pageIndex));d.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));this.shouldShowPromoHeader()&&d.push(this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,
c.translatedPromoStrings||[]));n.isEnabled||this.overrideRefinementTitleForSearch(c);var k=g.bindCategoryRefinementDataToTemplate(this.refinementSearchViewTemplate,c,this.deviceType,{searchResultsExist:0<c.selectionItemsAttributeList.length,searchOffersOnly:this.searchOffersOnly,isFirstSearch:!h});k.find(a.howToLinkHelperTitleId).text(c.refinementTitle);(this.tradeInProductGroup===a.tradeInEchoGl||e.isVGProductGroup(this.tradeInProductGroup)&&0===this.config.restrictionHistory.length)&&k.find("#howToHelper").addClass("aok-hidden");
this.updateSearchCounts(k);this.populateUnavailableOffers(k);c.endOfResults?k.find(a.searchLoadMoreResultsWrapperClass).addClass("aok-hidden"):k.find(a.searchLoadMoreResultsWrapperClass).removeClass("aok-hidden");d.push(k);d.push(this.createFooterComponent());this.renderTemplateView(d,f.proxy(function(){g.normalizeGridRowHeights(k);h&&this.getSearchInput(this.tradeInWrapper).val(this.tradeInSearchCurrentState.term)},this))},handleReturnAddressChange:function(b){var c=f(b.currentTarget);e.isMobileVariant(this.deviceType)&&
(c=f(b));e.recordTv2RefTag(a.refTagReturnAddressUpdateRequest,this.tradeInRefTagUrl,this.bifurcationRefTags);this.loadingSpinnerShow();l.post(this.tradeInReviewUrl,{params:{addressId:c.attr("value"),requestToken:e.getCsrfTokenByKey(a.csrfReviewRequestKey,this.config)},success:f.proxy(function(b){e.updateCsrfTokenByKey(a.csrfReviewRequestKey,b,this.config);c.closest(".popover-content-overlay").addClass("aok-hidden");this.loadingSpinnerHide();this.tradeInReviewData=b;this.createView()},this),error:f.proxy(function(a){this.handleRequestError(a,
"TradeIn return address error","Error encountered during TradeIn return address update request")},this)})},cleanState:function(){this.restrictionSelectionPage=[];this.priceHistory=[];this.navCurrentView=null;this.estimatedMaxTiv=0;this.invalidReturnAddress=this.isProcessing=this.showVerticalImageCardView=!1;this.conditionSelectionMap=this.finalSearchResults=this.searchTradeInImageIndicator=null;this.isChangeConditionContext=!1;this.tradeInReviewData={};this.tradeInSearchCurrentState={term:""};this.bifurcationRefTags=
[];f(a.searchSuggestionsClass).remove()},clearAllViews:function(){this.tradeInWrapper.children().each(function(){f(this).data("keep")||f(this).remove()})},handleRefinementSubmit:function(b){if(!this.selectionInProgress){var c=this.config,d=c.restrictionHistory,g=f(b.target);b=g.data("tradeinSupplementaryData");var h=g.data("refinementKey"),g=g.data("refinementValue"),h={key:h,emittedData:g};h.key&&h.emittedData&&(d.push(h),-1!==a.BIFURCATION_REF_TAG.indexOf(h.key)&&this.generateBifurcationTag(h.emittedData));
b.maxTiv&&(this.estimatedMaxTiv=b.maxTiv,0<b.maxTiv?this.priceHistory.push(this.estimatedMaxTiv):e.recordError("Invalid TIV","TIV is zero"));c={configVersion:c.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(d),currentAsin:e.getCurrentAsin(),pageIndex:c.pageIndex+1};this.callForwardRefinementSelection(c)}},handlePastPurchaseRefinementSelect:function(b){if(!this.selectionInProgress){var c=
f(b.target)[0].dataset.asin,d,g,h,k;this.pastPurchaseSelected=!0;f.each(this.pastPurchasedEligibleItems,f.proxy(function(b,f){f.asin===c&&(this.currentAsin.asin=c,this.currentAsin.title=e.generatePrettyTitle(f.title),g=f.imageUrl,h=this.questionnaires[f.tradeInItemType].questions,k=f.conditionOfferMap,d=f.tradeInItemType===a.tradeInItemTypeEcho?f.conditionOfferMap.Working.tiv:f.conditionOfferMap.Good.tiv)},this));b=this.config;var l=b.restrictionHistory;b={configVersion:b.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,
this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(l),currentAsin:e.getCurrentAsin(),maxTiv:d,verticalImageUrl:g,tradeInQuestions:h,conditionOfferMap:k,asin:c,pageIndex:b.pageIndex+1};this.callFastForwardToSelfGrading(b)}},handleRefinementSearchFormSubmit:function(b){if(!this.selectionInProgress){if(b){b.preventDefault();b=f(b.currentTarget);b=this.getSearchInput(b);b=l.trim(b.val());if(!b)return;this.tradeInSearchCurrentState.term=b}b=this.config;var c=b.restrictionHistory;
b={configVersion:b.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(c),currentAsin:e.getCurrentAsin(),keyword:this.tradeInSearchCurrentState.term,pageIndex:b.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:0};this.callForwardRefinementSelection(b)}},handleLoadMoreSearchResults:function(){this.selectionInProgress=!0;var b=this.config,b={configVersion:b.configVersion,
requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(b.restrictionHistory),currentAsin:e.getCurrentAsin(),keyword:this.tradeInSearchCurrentState.term,pageIndex:b.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:b.selectionDetails.searchOffsetIndex};this.loadingSpinnerShow();l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:f.proxy(function(b){this.loadingSpinnerHide();
this.selectionInProgress=!1;e.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b,this.config);this.config=b;this.updateCartHeaderData();b=this.tradeInWrapper.find(a.refinementContentWrapperClass);var c=this.config.selectionDetails;n.isEnabled||this.overrideRefinementTitleForSearch(c);var d=g.bindCategoryRefinementDataToTemplate(this.refinementSearchViewTemplate,c,this.deviceType);this.populateUnavailableOffers(d);d=d.find(a.refinementContentWrapperClass);b.append(d.children());g.normalizeGridRowHeights(b);
this.updateSearchCounts(this.tradeInWrapper.find(a.refinementSelectionViewWrapperClass));c.hasOwnProperty("endOfResults")&&c.endOfResults?f(a.refinementSelectionViewWrapperClass).find(a.searchLoadMoreResultsWrapperClass).addClass("aok-hidden"):f(a.refinementSelectionViewWrapperClass).find(a.searchLoadMoreResultsWrapperClass).removeClass("aok-hidden")},this),error:f.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error","Error encountered hitting search refinement request")},
this)})},handlePreviousButton:function(){if(!this.selectionInProgress){var b=this.getCurrentViewForRefTag(),c=this.restrictionSelectionPage.pop(),d=this.restrictionSelectionPage[this.restrictionSelectionPage.length-1];this.navCurrentView=d;e.recordTv2RefTag(a.refTagBackButton+b,this.tradeInRefTagUrl,this.bifurcationRefTags);if(e.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&0===this.config.restrictionHistory.length)this.clearAllViews(),this.createRestrictionItemView();else switch(d){case this.navViews.refinementSelectionView:this.handleNavigateBackToSelectionPage(c);
break;case this.navViews.refinementSearchView:this.handleNavigateBackToSearchPage(c);break;case this.navViews.tradeInConditionView:this.handleNavigateBackToConditionPage(c);break;case this.navViews.submitTradeInView:this.handleNavigateBackToReviewPage(c);break;case this.navViews.tradeInCartView:this.handleNavigateBackToCartPage(c);break;default:this.clearAllViews(),e.recordError("Error encountered navigating from "+c+" back to "+d),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}}},
handleNavigateBackToSelectionPage:function(b){var c=this.config.restrictionHistory;if(b!==this.navViews.tradeInCartView){this.config.pageIndex--;var d=c.pop();this.priceHistory.pop();-1!==a.BIFURCATION_REF_TAG.indexOf(d.key)&&this.bifurcationRefTags.pop()}b===this.navViews.refinementSearchView&&(this.tradeInSearchCurrentState.term="");b={configVersion:this.config.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(c),
currentAsin:e.getCurrentAsin(),pageIndex:this.config.pageIndex};this.restrictionSelectionPage.pop();this.callForwardRefinementSelection(b)},handleNavigateBackToSearchPage:function(b){var c=this.config.restrictionHistory,d=this.tradeInSearchCurrentState.term&&0<this.tradeInSearchCurrentState.term.length?this.tradeInSearchCurrentState.term:"";b!==a.tradeInCartViewClass&&(this.config.pageIndex--,c.pop(),this.priceHistory.pop());b={configVersion:this.config.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,
this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(c),currentAsin:e.getCurrentAsin(),keyword:d,pageIndex:this.config.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:0};this.restrictionSelectionPage.pop();this.callForwardRefinementSelection(b)},handleNavigateBackToConditionPage:function(b){this.restrictionSelectionPage.pop();var c={configVersion:this.config.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,
this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(this.config.restrictionHistory),currentAsin:e.getCurrentAsin(),pageIndex:this.config.pageIndex};b===a.submitTradeInWrapperClass?this.finalSearchResults&&this.finalSearchResults.hasOwnProperty("asin")&&this.doTradeInItemRemove(this.finalSearchResults.asin,f.proxy(function(){this.callForwardRefinementSelection(c)},this)):this.callForwardRefinementSelection(c)},handleNavigateBackToReviewPage:function(b){if(b===a.tradeInCartViewClass){var c=
this.finalSearchResults.asin;this.getSanitizedItemListFromReviewData().some(function(a){return a.asin===c})?this.doTradeInReviewValidation(f.proxy(function(){this.selectionInProgress=!1;this.navCurrentView=this.navViews.submitTradeInView;this.createView()},this)):this.handleTradeInMoreItems()}},handleNavigateBackToCartPage:function(a){a===this.navViews.tradeInConditionView&&(this.isChangeConditionContext=!1,this.restrictionSelectionPage.pop(),this.handleNavigateToCart())},updateCartHeaderData:function(){var a=
this.config;a.hasOwnProperty("cartItems")&&(this.tradeInCartQuantity=a.cartItems.length,this.tradeInCartTiv=a.cartItems.reduce(function(a,b){return a+b.price},0))},handleNavigateToCart:function(){this.doTradeInReviewValidation(f.proxy(function(){this.navCurrentView=this.navViews.tradeInCartView;this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this))},handlePrintShippingLabel:function(){var b="https://"+t.location.host;-1<b.indexOf("aka.corp.amazon.com")&&(b="https://development.amazon.com");
b=b+"/tradein/ya/print-label/"+this.tradeInSubmitData.orderId+"?loc\x3d"+this.config.locale+"\x26ref\x3d"+a.refTagPrintShippingLabel+"_"+e.getDeviceType()+"_"+e.getProductGroup();t.open(encodeURI(b),"_blank")},createTradeInCartView:function(){try{var b=[];b.push(this.createTradeInHeaderComponent(!0));var d=this.tradeInCartTemplate.clone(),h=this.getSanitizedItemListFromReviewData();d.find(a.tradeinCartTotalTivElement).html(e.formatCurrency(this.tradeInReviewData.orderTotalGC));d.find(a.tradeinCartGCValueIpElement).html(e.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly));
d.find(a.tradeinCartGCValueNonIpElement).html(e.formatCurrency(this.tradeInReviewData.orderTotalPaidOnGrading));e.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&d.find(".tradein-cart-view .tradein-cart-view-review-text").addClass("aok-hidden");var l=[],m=[];f.each(h,f.proxy(function(a,b){a=g.bindDataToAsinSelectionTemplate(this.tradeinCartItemComponent,{title:e.generatePrettyTitle(b.title),tradeInValue:b.tradeInValue,imageUrl:b.imageUrl,instantPaymentEligible:b.instantPayable,asin:b.asin})[0].outerHTML;
b.instantPayable?l+=a:m+=a},this));0<l.length?d.find(a.tradeinCartIpItemsList).append(l):(d.find(a.tradeinCartIpItemsSection).addClass("aok-hidden"),d.find(a.tradeinCartNonIpItemsSection+".a-divider-normal").addClass("aok-hidden"));0<m.length?d.find(a.tradeinCartNonIpItemsList).append(m):d.find(a.tradeinCartNonIpItemsSection).addClass("aok-hidden");if(this.shouldShowPromos()){this.promoData=this.tradeInReviewData.promotionEligibilityText;this.tradeInReviewData.hasOwnProperty("promotionMessages")&&
this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var p;p=c.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);b.push(p)}this.validateReturnAddress(b);b.push(d);b.push(this.shipmentDetailsHeaderComponent);b.push(this.createShipmentDetailComponent());var n=this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace;
this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")&&this.tradeInReviewData.instantPaymentEligible&&n&&e.isCETechGl(this.tradeInProductGroup)&&b.push(this.createIPPreferenceComponent());this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,b.push(this.dropOffBannerNoLinkComponent));var q=this.tradeinSubmitButtonComponent.clone();this.invalidReturnAddress||0===h.length?k(q.find(a.submitButtonViewClass)).disable():
k(q.find(a.submitButtonViewClass)).enable();b.push(q);b.push(this.createFooterComponent());this.renderTemplateView(b)}catch(t){e.recordError(t,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},handleRemoveCartItem:function(a){a=f(a.currentTarget).data("asin");this.doTradeInItemRemove(a,f.proxy(function(){1===this.getSanitizedItemListFromReviewData().length?(this.tradeInReviewData={},this.handlePreviousButton()):
(this.restrictionSelectionPage.pop(),this.handleNavigateToCart())},this))},handleNavigateToChangeCondition:function(a){this.selectionInProgress=!0;this.loadingSpinnerShow();a={asin:f(a.target)[0].dataset.asin};l.get(this.tradeInGetSelfGradingQuestionnaireUrl,{params:a,success:f.proxy(function(a){this.loadingSpinnerHide();this.selectionInProgress=!1;this.navCurrentView=this.navViews.tradeInConditionView;this.restrictionSelectionPage.push(this.navCurrentView);this.isChangeConditionContext=!0;this.changeConditionData=
a.finalSearchResult;this.createView()},this),error:f.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"getSelfGradingQuestionnaire error","Error encountered calling getSelfGradingQuestionnaire")},this)})},handleTermsAndAgreementCheckboxSelection:function(b,c){c=".agreement-checkbox-multi-item"===c;b=f(b.currentTarget);var d=!0;f(b).closest(".termsAndAgreementContent").find(".agreement-checkbox").each(function(a,b){f(b).find("input").get(0).checked||(d=!1)});b=k(a.agreementCheckboxTarget);
c?d?(this.checkBoxesChecked=!0,b.enable()):b.disable():d&&!this.invalidReturnAddress?(this.checkBoxesChecked=!0,b.enable()):b.disable()},handleAdjustedValueAgreementButton:function(a){a=f(a.currentTarget);var b=a.closest(".appraisal-container");f(b).find(".adjusted-value-agreement-button").each(function(a,b){k(f(b)).setStatus("normal")});b=f(a.closest(".adjusted-value-agreement-button"));k(b).setStatus("selected");b=b.find("input");this.conditionSelectionMap.tradeInQuestionResponses[b.attr("name")]=
b.attr("value");this.toggleConditionState(this.conditionSelectionMap,a,b.attr("name"))},handleIpPreferenceButton:function(b){b=f(b.currentTarget);var c=b.closest(".ip-pref-container");f(c).find(".ip-preference-button").each(function(a,b){k(f(b)).setStatus("normal")});b=f(b.closest(".ip-preference-button"));k(b).setStatus("selected");(this.customerIpPreference=b.find("input").attr("value"))&&this.customerIpPreference!==a.instantPaymentNow?(this.tradeInWrapper.find(".instantPaymentPreference-mfa").addClass("aok-hidden"),
e.recordTv2RefTag(a.refTagIPDowngrade,this.tradeInRefTagUrl,this.bifurcationRefTags)):(this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"),e.recordTv2RefTag(a.refTagIPUpgrade,this.tradeInRefTagUrl,this.bifurcationRefTags))},handleTradeInSubmit:function(){if(!this.hasPendingRequest){this.loadingSpinnerShow();this.hasPendingRequest=!0;var b=this.tradeInReviewData.instantPaymentEligible?"ip":"nip";this.customerIpPreference||(this.customerIpPreference=a.instantPaymentNow);
l.post(this.tradeInSubmitUrl+b,{params:{requestToken:e.getCsrfTokenByKey(a.csrfSubmitRequestKey,this.config),currentAsin:e.getCurrentAsin(),customerIpPreference:this.customerIpPreference,isStorefront:this.isStorefront,productGroup:this.tradeInProductGroup},success:f.proxy(function(b){this.tradeInSubmitData=b;try{if(this.tradeInSubmitData.hasOwnProperty("mfaUrl")&&this.tradeInSubmitData.mfaUrl){e.redirectToMFA(this.tradeInSubmitData.mfaUrl);return}this.promotionEligible&&(this.promosApplied.push({productGroup:this.tradeInProductGroup,
applied:!0}),t.sessionStorage.setItem("tradein-promos-applied",JSON.stringify(this.promosApplied)))}catch(c){e.recordError(c,a.sessionStorageAccessErrorMsg)}this.loadingSpinnerHide();this.hasPendingRequest=!1;this.updatePostTradeInMessage();this.navCurrentView=this.navViews.restrictionSearchTradeInNextStepView;this.config.pageIndex=this.expectedPages;this.createView();this.restrictionSelectionPage.push(this.navCurrentView);e.recordTv2RefTag(a.refTagEnd,this.tradeInRefTagUrl,this.bifurcationRefTags)},
this),error:f.proxy(function(a){this.hasPendingRequest=!1;this.clearAllViews();this.handleRequestError(a,"TradeIn submit error","Error encountered during TradeIn submit request")},this)})}},updatePostTradeInMessage:function(){var c=f(a.tradeInLaunchButtonDeclarativeActionSelector).data("action");!e.isTradeInLaunchedFromWisper(c)&&b&&0!==f(b.selectors.tradeInCCCardTemplate).length?(this.updateCCCardMessage(),e.recordMetric(this.tradeInProductGroup+"_submittedFromCCCard")):(this.updateLaunchButtonText(),
(p.isEnabled||q.isEnabled)&&e.isGlEligibleForCCCard(this.tradeInProductGroup)&&e.recordMetric(this.tradeInProductGroup+"_submittedFromBuyBox"))},updateCCCardMessage:function(){var a=b.selectors,c=this.getIsIpOnlyOfferFromSubmitData(),g=this.getIsMixedOfferFromSubmitData(),h=this.getIsPromotionEligibleFromReviewData(),k=f(a.successMessage).clone(),m=k.find(a.tivMessage),p=f(a.ccPostTradeInMessageTemplate).clone(),n;c?(n=f(a.ccIpTiMessage).clone(),n.find(a.ccCardTotalTiv).text(e.formatCurrency(this.tradeInReviewData.orderTotalGC))):
g?(n=f(a.ccMixedTiMessage).clone(),n.find(a.ccCardTotalTiv).text(e.formatCurrency(this.tradeInReviewData.orderTotalGC)),n.find(a.ccCardIpTiv).text(e.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly))):(n=f(a.ccNipTiMessage).clone(),n.find(a.ccCardTotalTiv).text(e.formatCurrency(this.tradeInReviewData.orderTotalGC)));p.find(a.ccTiMessageContent).empty().append(n);m.append(p);var m=this.tradeInReviewData.promotionEligibilityText,q=m.length;if(!h||1>q)k.remove(a.promoMessage);else{h=f(a.ccPostTradeInMessageTemplate).clone();
p=k.find(a.promoMessage);n=f(a.ccPromoMessageContent).clone();var t=n.find(a.promoTitle),u=n.find(a.promoSubtitle);if(1<q){var v=f(a.promoTitleMultiple).clone();v.find(a.lastPromoTitle).text(m[q-1]);v.find(a.remainingPromoAmount).text(q-1);t.text(v.text())}else q=f(a.promoTitleSingle).clone(),q.find(a.singlePromoTitle).text(m[0]),t.text(q.text());c=c||g?f(a.ipPromoSubtitle).text():f(a.nipPromoSubtitle).text();u.text(c);h.find(a.ccTiMessageContent).empty().append(n);p.append(h)}f(a.expanderContent).empty().append(k);
f(a.subtitleWrapper).empty().append(f(a.submittedMessage));d&&"true"===f(a.collapseAfterSubmission).val()&&l.trigger(b.actions.postTradeInExp);l.trigger(b.actions.postTradeInMultiCardExp)},handleTradeInMoreItems:function(){if(!this.selectionInProgress){var b=this.config;b.pageIndex=1;b.restrictionHistory=[];this.cleanState();b={configVersion:b.configVersion,requestToken:e.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(b.restrictionHistory),
pageIndex:b.pageIndex};this.callForwardRefinementSelection(b)}},callFastForwardToSelfGrading:function(b){try{this.selectionInProgress=!0;this.loadingSpinnerShow();var c=b.maxTiv;this.searchTradeInImageIndicator=b.verticalImageUrl;this.finalSearchResults={gradingQuestion:b.tradeInQuestions,conditionOfferMap:b.conditionOfferMap,asin:b.asin};l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:f.proxy(function(b){this.selectionInProgress=!1;e.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,
b,this.config);this.config=b;this.estimatedMaxTiv=c;this.navCurrentView=this.navViews.tradeInConditionView;this.updateCartHeaderData();this.loadingSpinnerHide();this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this),error:f.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error","Error encountered hitting search refinement request")},this)})}catch(d){this.selectionInProgress=!1,this.clearAllViews(),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},
callForwardRefinementSelection:function(b){try{this.selectionInProgress=!0,this.loadingSpinnerShow(),l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:f.proxy(function(b){this.selectionInProgress=!1;e.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b,this.config);this.config=b;if(b.hasOwnProperty("selectionDetails")){var c=b.selectionDetails;c.hasOwnProperty("searchRestrictionAttributes")&&c.searchRestrictionAttributes.hasOwnProperty("verticalImageUrl")&&(this.showVerticalImageCardView=
!0,this.searchTradeInImageIndicator=c.searchRestrictionAttributes.verticalImageUrl);b=b.selectionDetails.viewType;b===a.complexCardRefinementSelectionViewType||b===a.simpleCardRefinementSelectionViewType||b===a.containedButtonRefinementSelectionViewType?this.navCurrentView=this.navViews.refinementSelectionView:b===a.searchRefinementViewType&&(this.navCurrentView=this.navViews.refinementSearchView,this.restrictionSelectionPage[this.restrictionSelectionPage.length-1]===this.navCurrentView&&this.restrictionSelectionPage.pop())}else b.hasOwnProperty("finalSearchResult")&&
(this.finalSearchResults=b.finalSearchResult,this.estimatedMaxTiv=this.finalSearchResults.maxTiv,this.navCurrentView=this.navViews.tradeInConditionView,b.finalSearchResult.hasOwnProperty("verticalImageUrl")&&(this.searchTradeInImageIndicator=b.finalSearchResult.verticalImageUrl));this.updateCartHeaderData();this.loadingSpinnerHide();this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this),error:f.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error",
"Error encountered hitting search refinement request")},this)})}catch(c){this.selectionInProgress=!1,this.clearAllViews(),this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active")}},handleContinueConditionButtonClick:function(){if(!this.isProcessing){this.isProcessing=!0;var b=!1===this.isLowestAppraisal?this.conditionSelectionMap.tradeInQuestionResponses.appraisal:"ACCEPT_WORSE";e.recordTv2RefTag(a.APPRAISAL_REF_TAG[b],this.tradeInRefTagUrl,this.bifurcationRefTags);
this.loadingSpinnerShow();b={asin:this.finalSearchResults.asin,condition:this.conditionSelectionMap.gradedCondition,returnOption:b,requestToken:e.getCsrfTokenByKey(a.csrfSaveGradedItemKey,this.config)};l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:f.proxy(function(b){e.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b,this.config);this.loadingSpinnerHide();this.config.pageIndex++;this.conditionSelectionMap.hasBeenGraded=!0;this.doTradeInReviewValidation(f.proxy(function(){this.navCurrentView=
this.navViews.submitTradeInView;this.createView();this.restrictionSelectionPage.push(this.navCurrentView);this.isProcessing=!1},this))},this),error:f.proxy(function(a){this.isProcessing=!1;this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},this)})}},handleChangeConditionComplete:function(){if(!this.isProcessing){this.isProcessing=!0;this.loadingSpinnerShow();var b={asin:this.changeConditionData.asin,condition:this.conditionSelectionMap.gradedCondition,
returnOption:this.conditionSelectionMap.tradeInQuestionResponses.appraisal,requestToken:e.getCsrfTokenByKey(a.csrfSaveGradedItemKey,this.config)};l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:f.proxy(function(b){this.loadingSpinnerHide();this.isProcessing=!1;e.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b,this.config);this.conditionSelectionMap.hasBeenGraded=!0;this.handleNavigateBackToCartPage(this.restrictionSelectionPage.pop())},this),error:f.proxy(function(a){this.isProcessing=
!1;this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},this)})}},handleConditionSelection:function(b){try{var c=f(b.currentTarget),d=c.closest(a.conditionQuestionButtonSelectorClass);this.conditionSelectionMap.tradeInQuestionResponses[d.attr("name")]=d.val();this.toggleConditionState(this.conditionSelectionMap,c,d.attr("name"))}catch(g){this.showAlert(a.alertItemAcceptableClass,c.closest(a.conditionQuestionContainerClass)),
k(f(d)).setStatus("normal"),k(a.continueConditionButtonViewClass).disable(),e.recordError(g,"Error occurred during handleConditionSelection")}},toggleConditionState:function(b,c,d){var e=[a.appraisalInputName];f.each(b.tradeInQuestions,function(a,b){b.hasOwnProperty("id")&&e.push(b.id)});var g=!1;f.each(e,f.proxy(function(a,c){"Unacceptable"===b.tradeInQuestionResponses[c]&&(g=!0)},this));var h=c.closest(a.conditionQuestionnaireListClass);g?(this.showAlert(a.alertItemAcceptableClass,c.closest(a.conditionQuestionContainerClass)),
h.find(a.conditionQuestionButtonSelectorClass).each(function(){f(this).attr("name")!==d&&(k(f(this)).disable(),f(this).addClass("a-button-unavailable"))})):(f(c).closest(a.conditionQuestionContainerClass).find(".alert-wrapper").html("").removeClass("active"),h.find(a.conditionQuestionButtonSelectorClass).each(function(){k(f(this)).enable();f(this).hasClass("a-button-unavailable")&&f(this).removeClass("a-button-unavailable")}));h=h.find(a.conditionQuestionContainerClass).length;c=Object.keys(b.tradeInQuestionResponses).length;
c>=h&&(this.tradeInWrapper.find(a.appraisalWrapperClass).removeClass("aok-hidden"),this.updateTradeInValue(b));h=k(a.continueConditionButtonViewClass);!g&&e.length===c||this.isLowestAppraisal&&!g&&e.length-1===c?h.enable():h.disable()},updateTradeInValue:function(b){var c=this.getConditionWeightageMap(b),d=[],g=null;f.each(b.tradeInQuestionResponses,function(b,e){b!==a.appraisalInputName&&d.push(c[e])});var h=l.reduce(d,function(a,b){return b&&b>a?b:a},0);f.each(c,function(a,b){if(b===h)return g=
a,!1});b.gradedCondition=g;b.tradeInValue=b.conditionOfferMap[g].tiv;var k=e.getSortedConditionTradeInValues(b),m=k.indexOf(b.tradeInValue),p=this.tradeInWrapper.find(a.appraisalWrapperClass),n=p.find(".appraisal-container"),p=p.find(".refinement-display-title-wrapper"),q=n.find(".appraisal-buttons-container"),t=this.tradeInWrapper.find(a.continueConditionButtonViewClass);k.length&&-1!==m&&(q.find(".adjusted-pricing").each(function(){f(this).addClass("aok-hidden")}),p.find(".no-appraisal-adjustment").addClass("aok-hidden"),
k=k.slice(0,m),this.isLowestAppraisal=!1,0===k.length?(this.isLowestAppraisal=!0,t.removeClass("a-button-disabled"),t.addClass("a-button-enabled"),n.addClass("aok-hidden"),p.find(".refinement-display-title").addClass("aok-hidden"),p.find(".no-appraisal-adjustment").removeClass("aok-hidden")):1===k.length?(n.removeClass("aok-hidden"),p.find(".refinement-display-title").removeClass("aok-hidden"),q.find(".adjusted-pricing-single").removeClass("aok-hidden")):2===k.length?(n.removeClass("aok-hidden"),
p.find(".refinement-display-title").removeClass("aok-hidden"),q.find(".adjusted-pricing-or").removeClass("aok-hidden"),n=e.formatCurrency(k[k.length-1]),this.tradeInWrapper.find(a.conditionAppraisalMaxTivClass).html(n)):2<k.length&&(n.removeClass("aok-hidden"),p.find(".refinement-display-title").removeClass("aok-hidden"),q.find(".adjusted-pricing-range").removeClass("aok-hidden"),n=e.formatCurrency(k[k.length-1]),this.tradeInWrapper.find(a.conditionAppraisalMaxTivClass).html(n)));b=e.formatCurrency(b.tradeInValue);
this.tradeInWrapper.find(a.conditionPageEstimatedTivComponentsSelector).addClass("aok-hidden");this.tradeInWrapper.find(a.conditionPageFinalTivComponentsSelector).removeClass("aok-hidden");this.tradeInWrapper.find(a.appraisalWrapperClass+" "+a.appraisalTivPriceClass).html(b);this.tradeInWrapper.find(a.conditionPageHeaderTivSelector).html(b)},handleRequestError:function(b,c,d){this.loadingSpinnerHide();b.http.status===a.unauthorizedCode?this.handleLoginPrompt():(e.recordError(c,d),this.clearAllViews(),
this.tradeInWrapper.append(f(".tradein-templates .tradein-general-error").clone()).addClass("active"))},handleLoginPrompt:function(){e.recordTv2RefTag(a.refTagAuthRequired,this.tradeInRefTagUrl,this.bifurcationRefTags);this.clearAllViews();this.tradeInWrapper.append(f("#alertTemplates "+a.alertPromptLoginClass).clone()).addClass("logged-out-message")},getConditionWeightageMap:function(a){var b=[],c={},d;for(d in a.conditionOfferMap)a.conditionOfferMap.hasOwnProperty(d)&&b.push([d,a.conditionOfferMap[d].tiv]);
b.sort(function(a,b){return b[1]-a[1]});f.each(b,function(a,b){c[b[0]]=a});return c},setGradedCondition:function(b){var c=this.getConditionWeightageMap(b),d=[],g=null;f.each(b.tradeInQuestionResponses,function(b,e){b!==a.appraisalInputName&&d.push(c[e])});var h=l.reduce(d,function(a,b){return b&&b>a?b:a},0);f.each(c,function(a,b){if(b===h)return g=a,!1});b.gradedCondition=g;b.tradeInValue=b.conditionOfferMap[g].tiv;this.tradeInWrapper.find("#conditionGrade_"+b.asin+" #estimatedTiv").html(e.formatCurrency(b.tradeInValue))},
loadingSpinnerShow:function(){this.loadingSpinner.addClass("active")},loadingSpinnerHide:function(){this.loadingSpinner.removeClass("active")},showAlert:function(a,b){f(b).find(".alert-wrapper").html("").removeClass("active");f(b.find(".alert-wrapper")).append(f("#alertTemplates "+a).clone()).addClass("active")},updateLaunchButtonText:function(){l.declarative.remove(f("#tradeInLaunchAction"),"launch-tanooki-wireless");l.declarative.remove(f("#tradeInLaunchAction"),"launch-tanooki-v2");var a=f(".tradein-instant-savings-launch-button"),
b="#successfulNonIpButtonText";this.tradeInReviewData.instantPaymentEligible&&(b=this.promotionEligible?"#successfulIpWithPromotionButtonText":"#successfulIpNoPromotionButtonText");b=f(".tradein-templates "+b).clone();f(b).find(".total-tiv").text(e.formatCurrency(this.tradeInReviewData.orderTotalGC));if(this.promotionEligible){var c=b.find(".promotionPercentageDisplayText").get(0);f(c).html(this.tradeInReviewData.promotionEligibilityText[0])}var d=b.get(0);f.each(a,function(){f(this).replaceWith(d)})},
doTradeInReviewValidation:function(b){this.hasPendingRequest||(this.loadingSpinnerShow(),this.hasPendingRequest=!0,l.post(this.tradeInReviewUrl,{params:{currentAsin:e.getCurrentAsin(),requestToken:e.getCsrfTokenByKey(a.csrfReviewRequestKey,this.config)},success:f.proxy(function(c){e.updateCsrfTokenByKey(a.csrfReviewRequestKey,c,this.config);this.tradeInReviewData=c;this.tradeInCartTiv=this.tradeInReviewData.orderTotalGC;this.tradeInCartQuantity=this.getSanitizedItemListFromReviewData().length;this.loadingSpinnerHide();
this.hasPendingRequest=!1;b()},this),error:f.proxy(function(a){this.hasPendingRequest=!1;this.handleRequestError(a,"TradeIn review error","Error encountered during TradeIn review request")},this)}))},getSanitizedItemListFromReviewData:function(){var a=this.tradeInReviewData.hasOwnProperty("sanitizedItemsList"),b=f.isArray(this.tradeInReviewData.sanitizedItemsList);return a&&b?this.tradeInReviewData.sanitizedItemsList:[]},getIsMixedOfferFromSubmitData:function(){return 0<this.tradeInSubmitData.ipItems&&
0<this.tradeInSubmitData.nonIpItems},getIsIpOnlyOfferFromSubmitData:function(){return 0<this.tradeInSubmitData.ipItems&&0===this.tradeInSubmitData.nonIpItems},getIsPromotionEligibleFromReviewData:function(){return this.tradeInReviewData.hasOwnProperty("promotionEligible")?this.tradeInReviewData.promotionEligible:!1},renderTemplateView:function(a,b){for(var c=0;c<a.length;c++)a[c]&&(e.isMobileVariant(this.deviceType)&&f(a[c]).find(".mobile-small-button").each(function(){f(this).addClass("a-button-small")}),
this.tradeInWrapper.append(a[c]));b&&"function"===typeof b&&b()},getSearchInput:function(b){var c=b.find(a.refinementSearchInputSelector);return c.is("input")||(c=b.find(a.refinementSearchInputMobileSelector),c.is("input"))?c:void 0},populateUnavailableOffers:function(a){a.find(".unavailable-item").each(function(){var a=f(this).find(".tiv-estimate-container"),b=a.find(".unavailable-offer");f(b).removeClass("aok-hidden");f(a).html(b)})},updateSearchCounts:function(b){var c=b.find(a.refinementSearchResultSelector).not(".aok-hidden").length;
b.find(this.searchOffersOnly?a.refinementSearchOnlyOffersCountId:a.refinementSearchAllOffersCountId).html(c)},overrideRefinementTitleForSearch:function(a){var b=this.config.restrictionHistory;b&&f.isArray(b)&&b[0].hasOwnProperty("emittedData")&&b[1].hasOwnProperty("emittedData")&&(a.refinementTitle=b[1].emittedData+" "+b[0].emittedData)},hasDefaultReturnAddress:function(){if(!this.tradeInReviewData.hasOwnProperty("defaultReturnAddressId")||!this.tradeInReviewData.defaultReturnAddressId)return f(".tradein-templates .tradein-info-submit-address-error").clone().addClass("active")},
hasInvalidReturnAddress:function(){if(!this.tradeInReviewData.hasOwnProperty("freeShipping")||!this.tradeInReviewData.freeShipping)return f(".tradein-templates .tradein-info-submit-invalid-address-error").clone().addClass("active")},validateReturnAddress:function(a){var b=this.hasDefaultReturnAddress();b?(this.invalidReturnAddress=!0,a.push(b)):this.invalidReturnAddress=!1;(b=this.hasInvalidReturnAddress())?(this.invalidReturnAddress=!0,a.push(b)):this.invalidReturnAddress=!1},recordViewRefTag:function(){e.recordTv2RefTag(this.getCurrentViewForRefTag(),
this.tradeInRefTagUrl,this.bifurcationRefTags)},getCurrentViewForRefTag:function(){var b=this.navCurrentView===this.navViews.refinementSelectionView?this.getCurrentRefinementTitleForRefTag():this.navCurrentView;return a.VIEW_REF_TAG[b]},getCurrentRefinementTitleForRefTag:function(){var a=this.config;return a.selectionDetails&&a.selectionDetails.refinementTitle?a.selectionDetails.refinementTitle.split(" ").join("-"):""},generateBifurcationTag:function(a){this.bifurcationRefTags.push(this.getCurrentViewForRefTag()+
"_"+a.substring(0,3))},load_stub_tester:function(b){this.config=l.state("tradeInConfig");e.setLocale(this.config.locale);e.setCurrencyCode(this.config.currencyCode);g.setCommonUtils(e);this.navViews={refinementSelectionView:a.refinementSelectionViewWrapperClass,tradeInConditionView:a.conditionViewTemplateId,submitTradeInView:a.submitTradeInWrapperClass,restrictionSearchTradeInNextStepView:a.tradeinReviewYourOrderNextStepTemplateId};this.getElements();this.bindEvents();this.cleanState();this.navCurrentView=
b;this.createView()}})});"use strict";u.when("A","trade-in-constants","trade-in-data-binder","trade-in-common-utils","ready").register("trade-in-common-base",function(l,m,k,a){var h=l.$;return l.createClass({createReturnAddressInstance:function(a){if(this.tradeInReviewData&&0<a.length)if(0===a.children().length){for(var g in this.tradeInReviewData.returnAddresses)if(this.tradeInReviewData.returnAddresses.hasOwnProperty(g)){var c=this.tradeInReviewData.returnAddresses[g];c.formalAddress=k.bindDataToTemplate(h("#addressLineFormalTemplate"),
c);var b=k.bindDataToTemplate(h("#addressLineItemTemplate"),c),d=this.tradeInReviewData.defaultReturnAddressId===c.addressId;b.find('input[type\x3d"radio"]').val(c.addressId).prop("checked",d);b.data("templateModel",c);a.append(b)}a.delegate('input[type\x3d"radio"]',"change",h.proxy(this.handleReturnAddressChange,this))}else a=a.find('input[type\x3d"radio"]'),h.each(a,h.proxy(function(a,b){a=h(b);a.prop("checked",a.val()===this.tradeInReviewData.defaultReturnAddressId)},this))},doTradeInItemRemove:function(e,
g){try{this.loadingSpinnerShow(),l.post(this.tradeInRemoveItemUrl,{params:{asin:e,decline:!0,requestToken:a.getCsrfTokenByKey(m.csrfRemoveRequestKey,this.config)},success:h.proxy(function(c){a.updateCsrfTokenByKey(m.csrfRemoveRequestKey,c,this.config);this.loadingSpinnerHide();g&&"function"===typeof g&&g()},this),error:h.proxy(function(a){this.handleRequestError(a,"TradeIn deselect remove error","Error encountered during TradeIn deselect remove request")},this)})}catch(c){a.recordError(c,"doTradeInItemRemove error")}}})});
"use strict";u.register("tradein-show-promotion-expander",function(){return{isEnabled:!1}});"use strict";u.register("ip-preference-buttons",function(){return{isEnabled:!1}});"use strict";u.register("search-refinement-title-migration",function(){return{isEnabled:!0}});"use strict";u.register("tanooki-ingress-button-treatment",function(){return{isEnabled:!1}});"use strict";u.register("trade-in-cc-card-wireless-gl-gate",function(){return{isEnabled:!0}});"use strict";u.register("trade-in-cc-card-wireless-gl-gate-mobile",
function(){return{isEnabled:!0}});"use strict";u.when("trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile").register("trade-in-cc-constants",function(l,m){if(l.isEnabled||m.isEnabled)return{featureName:"tradeInInstantSavings",featureAttribution:"Website/CETech/WirelessPlans",actions:{expand:"trade-in-cc-card:expanded",collapse:"trade-in-cc-card:collapse",atfRefresh:"PageRefresh:ATF",ingress:"trade-in-button:ingress",postTradeInExp:"trade-in-cc:postTradeInExp",postTradeInMultiCardExp:"trade-in-cc:postTradeInMultiCardExp"},
selectors:{expanderIcon:".trade-in-cc-header-icon",expanderContentWrapper:".trade-in-cc-expander-content-wrapper",expanderContent:".trade-in-cc-expander-content",expanderContentPre:".trade-in-cc-expander-content-pre",expandInitiallyInput:".trade-in-cc-expand-initially-input",tradeInCCCardTemplate:".trade-in-cc-card-template",successMessage:".trade-in-cc-card-template .trade-in-cc-success-message",tivMessage:".trade-in-cc-tiv-message",promoMessage:".trade-in-cc-promo-message",subtitleWrapper:".trade-in-cc-subtitle-wrapper",
subtitle:".trade-in-cc-subtitle",submittedMessage:".trade-in-cc-submitted-message",ccCardTotalTiv:".cc-card-total-tiv",ccCardIpTiv:".cc-card-ip-tiv",promoTitle:".trade-in-cc-promo-title",promoSubtitle:".trade-in-cc-promo-subtitle",ipPromoSubtitle:".trade-in-cc-ip-promo-subtitle",nipPromoSubtitle:".trade-in-cc-non-ip-promo-subtitle",promoTitleSingle:".trade-in-cc-promo-title-single",singlePromoTitle:".single-promo-title",promoTitleMultiple:".trade-in-cc-promo-title-multiple",lastPromoTitle:".last-promo-title",
remainingPromoAmount:".remaining-promo-amount",collapseAfterSubmission:"input[name\x3d'tradeInCCCardCollapseAfterSubmission']",ccPostTradeInMessageTemplate:".cc-post-trade-in-message-template",ccTiMessageContent:".cc-post-trade-in-message-content",ccIpTiMessage:".trade-in-cc-ip-ti-message",ccNipTiMessage:".trade-in-cc-non-ip-ti-message",ccMixedTiMessage:".trade-in-cc-mix-ti-message",ccPromoMessageContent:".trade-in-cc-promo-message-content",multiCardExperimentData:"wireless-multi-card",multiCardExperimentElement:"[data-wireless-multi-card]",
activeTPlusCards:"#twister-plus-active-cards"},classes:{hidden:"aok-hidden",rotate:"rotate",tradeInCCExpanded:"trade-in-cc-expander-content-wrapper-expanded",contentHidden:"content-hidden"}}});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile").register("trade-in-cc-expander",function(l,m,k,a){function h(a){e(g.expanderIcon).toggleClass(c.rotate,a);e(g.subtitleWrapper).toggleClass(c.hidden,a);e(g.expanderContent).toggleClass(c.contentHidden,
!a);return e(g.expanderContentWrapper).toggleClass(c.tradeInCCExpanded,a).hasClass(c.tradeInCCExpanded)}if(k.isEnabled||a.isEnabled){var e=l.$,g=m.selectors,c=m.classes;return{toggleCard:h}}});"use strict";u.when("A","cc-manager","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate").register("trade-in-cc-registration",function(l,m,k,a){a.isEnabled&&(a={featureName:k.featureName,featureAttribution:k.featureAttribution},l.on(k.actions.expand,function(){m.cardExpanded(k.featureName)}),m.registerFeature(a,
{init:function(){},validateInputParams:function(){return!0},cardCollapse:function(){l.trigger(k.actions.collapse)}}))});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-expander","trade-in-cc-card-wireless-gl-gate","trade-in-cc-registration").execute(function(l,m,k,a){function h(){var a=!g(b.expanderContentWrapper).hasClass(d.tradeInCCExpanded);k.toggleCard(a);a&&l.trigger(c.expand)}function e(){"true"===g(b.expandInitiallyInput).val()&&k.toggleCard(!0)}if(a.isEnabled){var g=l.$,c=m.actions,
b=m.selectors,d=m.classes;l.declarative("toggle-trade-in-cc-card","click",h);l.on(c.collapse,function(){k.toggleCard(!1)});l.on(c.atfRefresh,function(){e()});e()}});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile","trade-in-cc-registration").execute("trade-in-cc-metrics",function(l,m,k,a){if(k.isEnabled||a.isEnabled){var h=m.actions,e=function(){var a=t.ue;return{incrementCount:function(c){a&&a.count&&c&&(c="twisterPlus_tradeIn_"+
c+"."+m.featureName,a.count(c,(a.count(c)||0)+1))}}}();l.declarative("launch-tanooki-v2",function(){l.trigger(h.ingress)});l.on(h.expand,function(){e.incrementCount("ccExpanded")});l.on(h.ingress,function(){e.incrementCount("ccIngress")})}});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-expander","trade-in-cc-card-wireless-gl-gate","trade-in-asin-category-selection-base-controller").execute(function(l,m,k,a,h){if(a.isEnabled)l.on(m.actions.postTradeInExp,function(){k.toggleCard(!1)})})});